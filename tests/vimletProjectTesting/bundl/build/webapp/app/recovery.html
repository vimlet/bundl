<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tobeio - Recovery</title>

    <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon/favicon-16x16.png">
    <link rel="manifest" href="img/favicon/site.webmanifest">
    <link rel="mask-icon" href="img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#4b4b4b">
    <meta name="theme-color" content="#ffffff">

    <script src="eon/eon-bundle.js"></script>
    <link rel="stylesheet" type="text/css" href="css/login.css">
    <script>
        eon.theme = "login-claro";

        window.locale = navigator.language.split("-")[0] == "es" ? "es" : "en";

        eon.createCallback("onLocaleLoaded", eon, "ready");

        eon.ajax("util/locale/" + window.locale + ".json", null, function (error, data) {
            if (!error) {
                eon.locale = JSON.parse(data.responseText);
                eon.triggerCallback("onLocaleLoaded", eon, eon, []);
            }
        });

        // Eon elements
        eon.import([
            "eon/ui/eon-form",
            "eon/ui/eon-text",
            "eon/ui/eon-dialog",
            "eon/ui/eon-button",
        ]);

        function recover() {
            var email = $1("[name='email']").value;

            if (validateEmail(email)) {

                eon.ajax("/rest/user/recovery", {

                    method: "POST",
                    contentType: "application/json",
                    payload: JSON.stringify({
                        email: email
                    })

                }, function (error, data) {

                    // if (!error) {
                    showInfoDialog(eon.locale.recovery.instructionsSent);
                    // }

                });

            }

        }

        function validateEmail(email) {
            var re = /^(([^<>()\[\]\\.,;:\s@"À-ž]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }

        function showInfoDialog(content, cb) {
            var dialog = document.querySelector("#alert-dialog");
            eon.locale.alertMessage = content;

            dialog.onClose(function () {
                if (cb) {
                    cb()
                }
            });

            dialog.open();
        }

        document.addEventListener("keyup", function (e) {
            if (e.keyCode == 13) {
                recover();
            }
        });

    </script>

</head>

<!-- class notraslate necessary to avoid page translation -->

<body theme="login-claro" class="notranslate">

    <div class="container">
        <div class="logo"></div>
        <div class="title">
            <eon-variable bind="locale.recovery.title" global="true"></eon-variable>
        </div>
        <eon-form class="form">
            <eon-text bind:label="global locale.recovery.mail" bind:placeholder="global locale.login.mailPlaceHolder"
                name="email" inline="false" value="" label-anim="false"></eon-text>

            <eon-button class="register-button" bind:label="global locale.recovery.recover" onclick="recover();">
            </eon-button>
        </eon-form>
    </div>

    <eon-dialog id="alert-dialog" class="alertDialog" modal="true" blur="true" closable="false" default-style="false">
        <eon-section type="content">
            <eon-variable class="alert-text" bind="locale.alertMessage" global="true"></eon-variable>
        </eon-section>
        <eon-section type="footer" location="right">
            <eon-button label="OK" design="flat" onclick="document.querySelector('#alert-dialog').close()"></eon-button>
        </eon-section>
    </eon-dialog>
</body>

</html>