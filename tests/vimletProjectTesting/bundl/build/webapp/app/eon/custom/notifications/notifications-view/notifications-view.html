<template>
</template>

<script>
  eon.element("notifications-view", {
    style: "notifications-view.css",
    parse: true,

    dependencies: [
      "@ui/eon-scroll",
      "@ui/eon-button",
      "@ui/eon-text"
    ],

    properties: {
      notifications: {
        value: "",
        observe: true
      }
    },

    privateProperties: {
      misc: {
        value: {}
      }
    },
    functions: {
      // @function refresh (public) [Refresh view]
      refresh: function () {
        var el = this;
        if (!app.isFirstVisit) {
          // mask.hide();
          el._hideLoadingMask();
        }
      },
      // @function getData (public) [Retrieve data from database] @param callback
      getData: function (callback) {
        var el = this;
        session.onReady(function () {
          var url = "/rest/notification/" + session.data.currentWorkspaceId;
          eon.ajax(url, {
            contentType: "application/json"
          }, function (error, data) {
            if (!error) {
              var data = JSON.parse(data.responseText);
              el.notifications = data;
              if (callback) {
                callback(el.notifications);
              }
            } else if (data.status == 401) {
              session.logout();
            }
          });
        });
      },
      // @function setData (public) [Print data to screen] @param-optional data [If not given previously stored data will be used]
      setData: function (data) {
        var el = this;
      },
      // @function loadData (public) [Load data from database]
      loadData: function () {
        var el = this;
        el.getData(function (data) {
          el.setData(data);
        });
      }
    },
    privateFunctions: {
      // @function _init (private)
      init: function () {
        var el = this;
        el._setup();
        session.onReady(function () {
          el.loadData();
        });
        el.refresh();
      },
      // @function _setup (private)
      setup: function () {
        var el = this;
        el._addListener();
        el._socketListeners();
      },
      // @function _addListener (private)
      addListener: function () {
        var el = this;
      },
      // @function _hideLoadingMask (private) [Hide loading mask when content is loaded]
      hideLoadingMask: function () {
        var el = this;
        // Hide loading mask if workspace is the first loaded
        mask.hide(null, 600);
      },
      // @function _socketListeners (private)
      socketListeners: function () {
        var el = this;
        app.socket.on("notification", function (socketData) {
          // console.log("socketData",socketData);
          
          // if (session.data.id != socketData.user) {
          //   var taskData = socketData.task;
          //   switch (socketData.action) {
          //     case "create":
          //       if (el._misc.columns[socketData.task.list]) {
          //         el._misc.columns[socketData.task.list].querySelector(
          //             ".board-view-list-content")
          //           .appendChild(el._addTask(socketData.task));
          //         el.tasks.push(socketData.task);
          //       }
          //       break;
          //     case "delete":
          //       el._onTaskDeleted(socketData.task.id);
          //       break;
          //     case "move":
          //       el._onTaskMoved(null, socketData.task.list, null, socketData.task
          //         .id, socketData.task.order);
          //       break;
          //   }
          // }


        });
      }
    },

    onCreated: function () {
      var el = this;
      eon.createCallback("onNotify", el, "ready");
    },

    onTransformed: function () {
      var el = this;
      el._init();
    },

    onReady: function () {
      var el = this;
      session.onWorkspaceChanged(function () {
        el.reset();
        session.onReady(function () {
          el.loadData();
          el.refresh();
        });
      });
    }


  });
</script>