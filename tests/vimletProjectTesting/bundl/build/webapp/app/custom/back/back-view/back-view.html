<style>
  back-view {
    width: 100%;
  }

  back-view .table-header {
    /* background-color: #8c27cf; */
    color: white;
    padding: 10px 5px;
    font-size: 18px;
  }

  back-view .table-cell {
    width: 20%;
    overflow: hidden;
    padding: 5px;
  }

  back-view .table-row {
    display: flex;
    justify-content: space-between;
  }

  back-view .table-even {
    background-color: #f5f5f5;
  }

  back-view .table {
    display: flex;
    flex-direction: column;
  }
</style>
<template>
  <div>
    Total Workspaces: {{@ workspacesTotal}} <br>
    Active Workspaces (30days): {{@ workspacesActive}} <br>
    Users: {{@ usersTotal}} <br>
    Members: {{@ membersTotal}} <br>
    <br>

    <div class="table" eon-ref="back.table"></div>
  </div>
</template>

<script>
  eon.element({
    name: "back-view",
    parse: true,
    functions: {
      loadData: function () {
        var self = this;
        eon.ajax("/rest/back", null, function (error, data) {
          if (!error) {
            self.data = JSON.parse(data.responseText);

            var fragment = document.createDocumentFragment();
            var row;
            var entry;
            var members;
            var name;
            var last;
            var creation;

            var i = 0;

            // Create Headers
            row = document.createElement("div");
            row.classList.add("table-row")
            row.classList.add("table-header", "eon-bg1")

            name = document.createElement("div");
            name.classList.add("table-cell")
            name.innerHTML = "Name";
            row.appendChild(name);

            owner = document.createElement("div");
            owner.classList.add("table-cell")
            owner.innerHTML = "Owner";
            row.appendChild(owner);

            members = document.createElement("div");
            members.classList.add("table-cell")
            members.innerHTML = "Size";
            row.appendChild(members);

            last = document.createElement("div");
            last.classList.add("table-cell")
            last.innerHTML = "Last Seen";
            row.appendChild(last);

            creation = document.createElement("div");
            creation.classList.add("table-cell")
            creation.innerHTML = "Creation Date";
            row.appendChild(creation);

            fragment.appendChild(row);

            // Add entries
            for (var key in self.data.workspaces) {
              // Ignore __private descriptors
              if (key.indexOf("__") != 0) {
                entry = self.data.workspaces[key];

                row = document.createElement("div");
                row.classList.add("table-row")
                if (i % 2 != 0) {
                  row.classList.add("table-even");
                }
                i++;

                name = document.createElement("div");
                name.classList.add("table-cell")
                name.innerHTML = entry.name;
                row.appendChild(name);

                owner = document.createElement("div");
                owner.classList.add("table-cell")
                owner.innerHTML = entry.owner;
                row.appendChild(owner);

                members = document.createElement("div");
                members.classList.add("table-cell")
                members.innerHTML = entry.members;
                row.appendChild(members);

                last = document.createElement("div");
                last.classList.add("table-cell")
                last.innerHTML = Number.isInteger(entry.last) ? entry.last + " days" : "--";
                row.appendChild(last);

                creation = document.createElement("div");
                creation.classList.add("table-cell")
                // console.log("entry.creationDate: " + entry.creationDate);
                creation.innerHTML = entry.creationDate ? moment(entry.creationDate).format("YY/MM/DD") : "--";
                row.appendChild(creation);

                fragment.appendChild(row);
              }
            }

            self._refs.back.table.innerHTML = "";
            self._refs.back.table.appendChild(fragment);
          }
        });
      },
      refresh: function () {
        if (!app.isFirstVisit) {
          mask.hide();
        }
        this.loadData();
      }
    },
    onReady: function () {
      if (!app.isFirstVisit) {
        mask.hide();
      }
      this.loadData();
    }
  });
</script>