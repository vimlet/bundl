<template>
  <div eon-ref="titles" class="grid-titles eon-sect3">
    <!-- <eon-variable class="cell-empty" bind="locale.empty" global="true"></eon-variable> -->
    <eon-variable bind="locale.global.name" global="true"></eon-variable>
    <div class="cell-empty"></div>
  </div>
  <div eon-ref="entries" class="grid-entries">
    <div class="grid-entries" eon-ref="entries">
      <!-- MASK -->
      <div class="groups-grid-mask" eon-ref="mask">
        <div class="mask-row eon-mask-background1"></div>
        <div class="mask-row eon-mask-background1"></div>
        <div class="mask-row eon-mask-background1"></div>
        <div class="mask-row eon-mask-background1"></div>
        <div class="mask-row eon-mask-background1"></div>
      </div>
    </div>
  </div>
</template>

<script>
  eon.element("groups-grid", {

    style: "groups-grid.css",
    parse: true,

    dependencies: [
      "groups-entry"
    ],

    properties: {
      refs: {
        value: {}
      }
    },

    privateProperties: {
      refs: {
        value: {}
      },
      misc: {
        value: {}
      }
    },
    functions: {
      // @function refresh
      refresh: function (data) {
        var el = this;
        el.data = data;

        el.clean();
        el._createEntries(data.groups);
      },
      // @function clean
      clean: function () {
        this._refs.entries.innerHTML = "";
        this._refs.entries.appendChild(this._refs.mask);
      }
    },
    privateFunctions: {
      // @function _setup (private)
      setup: function () {
        var el = this;
        el._misc.entries = {};
      },
      // @function _createEntries (private)
      createEntries: function (entries) {
        var el = this;
        var fragment = document.createDocumentFragment();

        for (var key in entries) {
          var entry = entries[key];
          if (entry) {
            var entryEl = document.createElement("groups-entry");
            entryEl.name = entry.name;
            entryEl.groupId = key;
            entryEl.classList.add("grid-row");

            entryEl.onEdit(function (groupId) {
              eon.triggerCallback("onEdit", el, el, [groupId]);
            });
            fragment.appendChild(entryEl);
          }
        }

        var entriesKeys = entries ? Object.keys(entries) : [];
        // Show no entries message if needed
        if (entriesKeys && entriesKeys.length < 1 || !entriesKeys) {
          if (!this._refs.placeHolder) {
            this._refs.placeHolder = createPlaceHolderText(eon.locale.global.emptyGroups);
          }

          this._refs.entries.classList.add("grid-empty");
          fragment.appendChild(this._refs.placeHolder);

        } else {
          this._refs.entries.classList.remove("grid-empty");
        }

        mask.hideViewMask("groups-grid");

        el._refs.entries.appendChild(fragment);
      }
    },

    onCreated: function () {
      var el = this;
      eon.createCallback("onEdit", el);
    },
    onTransformed: function () {
      var el = this;
      el._setup();
    }
  });
</script>