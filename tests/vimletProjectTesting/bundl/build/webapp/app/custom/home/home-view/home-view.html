<template>

  <div class="title-row">
    <div class="breadcrumb-menu">
      <!-- <span eon-ref="back" class="breadcrumb-back eon-fg-h1 eon-fg-h1-hoverable ticon vicon-arrow-back clickable hide"></span> -->
      <eon-variable class="section-title eon-fg-h1" bind="locale.home.tasksTitle" global="true" eon-ref="title">
      </eon-variable>
    </div>

    <div class="box tab-selector" eon-ref="tabSelector">
      <div class="tab-node eon-fg1-hoverable eon-fg1-active" eon-ref="tasksTab">
        <i class="tab-icon ticon ticon-tasks"></i>
        <eon-variable class="tab-label eon-unselectable" bind="locale.home.tasksTitle" global="true"></eon-variable>
      </div>
      <div class="tab-spacer"></div>
      <div class="tab-node eon-fg1-hoverable" eon-ref="clockinTab">
        <i class="tab-icon ticon ticon-clocking"></i>
        <eon-variable class="tab-label tab-node eon-unselectable" bind="locale.home.clockin" global="true"></eon-variable>
      </div>

    </div>

    <!-- Tab menu button -->
    <div class="tab-menu-button box eon-fg2-hoverable" eon-ref="viewSelector">
      <i class="ticon ticon-tasks"></i>
      <eon-variable class="tab-menu-label eon-unselectable" bind="locale.home.tasksTitle" global="true"></eon-variable>
      <i class='vicon vicon-chevron-down'></i>
    </div>
  </div>

  <eon-swiper eon-ref="swiper" class="home-swiper" transition="500" external-slide="true">
    <!-- HOME -->
    <eon-swiper-slide id="home" class="home-swiper-child">

      <div class="home-main">

        <!-- Tasks resume header-->
        <div class="tasks-home">
          <div class="home-resume">
            <div class="task-stat task-stat-wip" eon-ref="inProgress">
              <!-- TEMP VALUES-->
              <div class="task-stat-value">
                <i class="ticon ticon-wip"></i>
                <span eon-ref="inProgress.value"></span>
              </div>
              <div class="task-stat-tag" eon-ref="inProgress.label"></div>
            </div>
            <div class="task-stat task-stat-pending" eon-ref="pending">
              <!-- TEMP VALUES-->
              <div class="task-stat-value">
                <i class="ticon ticon-pending"></i>
                <span eon-ref="pending.value"></span>
              </div>
              <div class="task-stat-tag" eon-ref="pending.label"></div>
            </div>
          </div>
          <!-- Progress bar -->
          <div class="home-progress" eon-ref="progress"></div>

          <!-- Lists swiper -->
          <div eon-ref="content" class="home-content">
            <!-- CONTENT MASK -->
            <div eon-ref="mask" class="home-content-mask">
              <div class="mask-row">
                <div class="home-mask-text eon-mask-background1"></div>
              </div>
              <div class="home-mask-row eon-mask-background1"></div>
              <div class="home-mask-row eon-mask-background1"></div>
              <div class="mask-row">
                <div class="home-mask-text eon-mask-background1"></div>
              </div>
              <div class="home-mask-row eon-mask-background1"></div>
              <div class="home-mask-row eon-mask-background1"></div>
              <div class="mask-row">
                <div class="home-mask-text eon-mask-background1"></div>
              </div>
              <div class="home-mask-row eon-mask-background1"></div>
              <div class="home-mask-row eon-mask-background1"></div>
              <div class="mask-row">
                <div class="home-mask-text eon-mask-background1"></div>
              </div>
              <div class="home-mask-row eon-mask-background1"></div>
              <div class="home-mask-row eon-mask-background1"></div>
            </div>

            <eon-swiper eon-ref="homeSwiper" id="home-swiper" external-slide="true">
              <eon-swiper-slide id="inProgress-tasks" class="home-swiper-child" eon-ref="inProgressList"></eon-swiper-slide>
              <eon-swiper-slide id="pending-tasks" class="home-swiper-child" eon-ref="pendingList"></eon-swiper-slide>
            </eon-swiper>
          </div>
        </div>
      </div>

    </eon-swiper-slide>

    <!-- CLOCK IN/OUT -->
    <eon-swiper-slide class="home-swiper-child attend-timelineSlide">

      <div class="home-main">

        <!-- BODY -->
        <div class="attend-body">
          <!-- DATA -->
          <eon-scroll class="attend-timeline-scroll" thickness="5" eon-ref="timelineScroll">
            <div class="attend-timelineWrapper">
              <div class="attend-timeline" eon-ref="timeline"></div>
            </div>
          </eon-scroll>

          <div class="attend-actionWrapper">

            <div class="attend-workedTime">
              <eon-variable class="attend-workedTimeLabel" bind="locale.home.workedTime" global="true"></eon-variable>
              <div class="attend-workedTimeValue" eon-ref="workedTimeValue"></div>
            </div>

            <!-- SLIDER -->
            <div class="attend-slider attend-sliderTransition eon-bg1" eon-ref="slider">

              <div class="attend-thumbWrapper" eon-ref="thumbWrapper">

                <div class="attend-floatingText" eon-ref="floatingText">
                  <eon-variable bind="locale.home.slideMessage" global="true"></eon-variable>
                </div>

                <div class="attend-sliderLoadingRotator" eon-ref="sliderLoadingRotator">
                  <div></div>
                  <div></div>
                  <div></div>
                  <div></div>
                </div>

                <div class="attend-sliderCross vicon-close" eon-ref="sliderErrorCross"></div>

                <div class="attend-thumb" eon-ref="thumb">
                  <i class="attend-thumbArrow vicon-chevron-right eon-fg0"></i>
                  <div class="attend-thumbIncreasedArea"></div>
                </div>

              </div>

            </div>

          </div>

        </div>

      </div>

    </eon-swiper-slide>

    <eon-swiper-slide class="home-swiper-child" eon-ref="formSlide">

      <div class="home-main">

        <div class="attend-navigation">

          <div class="attend-event-currentType" eon-ref="currentType">

            <div class="attend-event-currentTypeLabel" eon-ref="currentTypeLabel"></div>
            <div class="attend-event-currentTypeIcon vicon" eon-ref="currentTypeIcon"></div>

          </div>


        </div>


        <!-- BODY -->
        <div class="attend-bodyWrapper">
          <eon-scroll thickness="5">
            <div class="attend-body" style="justify-content: space-evenly;" eon-ref="eventSlideContent">

              <div class="attend-types-wrapper" eon-ref="eventTypes">

                <div class="attend-event-type eon-fg0-hoverable" eon-ref="typeButtons.break">
                  <div class="attend-event-iconWrapper">
                    <div class="attend-event-icon vicon ticon-coffee"></div>
                  </div>
                  <div class="attend-event-name">
                    <eon-variable bind="locale.events.break" global="true"></eon-variable>
                  </div>
                </div>

                <div class="attend-event-type eon-fg0-hoverable" eon-ref="typeButtons.food">
                  <div class="attend-event-iconWrapper">
                    <div class="attend-event-icon vicon ticon-food"></div>
                  </div>
                  <div class="attend-event-name">
                    <eon-variable bind="locale.events.food" global="true"></eon-variable>
                  </div>
                </div>

                <div class="attend-event-type eon-fg0-hoverable" eon-ref="typeButtons.absence">
                  <div class="attend-event-iconWrapper">
                    <div class="attend-event-icon vicon ticon-alert"></div>
                  </div>
                  <div class="attend-event-name">
                    <eon-variable bind="locale.events.absence" global="true"></eon-variable>
                  </div>
                </div>

                <div class="attend-event-type eon-fg0-hoverable" eon-ref="typeButtons.activity">
                  <div class="attend-event-iconWrapper">
                    <div class="attend-event-icon vicon ticon-meeting"></div>
                  </div>
                  <div class="attend-event-name">
                    <eon-variable bind="locale.events.activity" global="true"></eon-variable>
                  </div>
                </div>

              </div>

              <!-- Event Edit -->

              <attend-form eon-ref="eventForm">

              </attend-form>

            </div>
          </eon-scroll>
        </div>
      </div>
      </div>

    </eon-swiper-slide>

    <eon-swiper-slide>

      <div class="home-main">

        <!-- BODY -->
        <div class="attend-body" style="justify-content: space-evenly;" eon-ref="eventTypeSlide">


        </div>


      </div>

    </eon-swiper-slide>

  </eon-swiper>

  <!-- Overtime Dialog -->
  <eon-dialog closable="true" bind:heading="global locale.home.overtimeDialog.title" modal="true"
    eon-ref="overtimeDialog" class="alertDialog">
    <eon-section type="content">
      <div class="attend-overtimeDialog">
        <eon-variable bind="locale.home.overtimeDialog.content" global="true"></eon-variable>
        <eon-button class="attend-reopenWorkday" eon-ref="reopenWorkdayButton"
          bind:label="global locale.home.overtimeDialog.reopen">
        </eon-button>
        <eon-button class="attend-reopenWorkday" eon-ref="reopenWorkdayWithBreakButton"
          bind:label="global locale.home.overtimeDialog.reopenWithBreak">
        </eon-button>
        <eon-button class="attend-newWorkday" eon-ref="newWorkdayButton"
          bind:label="global locale.home.overtimeDialog.new">
        </eon-button>
      </div>
    </eon-section>
  </eon-dialog>

  <eon-dialog class="removeDialog alertDialog" default-style="false" closable="true"
    bind:heading="global locale.home.removeDialog.title" modal="true" eon-ref="removeDialog">
    <eon-section type="content">
      <div class="attend-removeDialog">
        <eon-variable bind="locale.home.removeDialog.content" global="true"></eon-variable>
      </div>
    </eon-section>
    <eon-section type="footer">
      <eon-button class="attend-event-confirmDelete delete-button" eon-ref="confirmRemove"
        bind:label="global locale.main.dialog.deleteButton" design="delete">
      </eon-button>
      <eon-button eon-ref="cancelRemove" bind:label="global locale.main.dialog.cancel">
      </eon-button>
    </eon-section>
  </eon-dialog>

  <!-- BUBBLE -->
  <!-- <app-bubble eon-ref="viewSelector" class="bubble-home eon-bg1 eon-fg1-tobeio" scroll-selector="body">
    <i class="ticon vicon-menu"></i>
  </app-bubble> -->

  <app-toggle-menu hidden-menu="true" content-full-width="false" content-class="tab-menu" anchor="right" margin="100"
    eon-ref="bubbleMenu" position="top">
    <div class="tab-menu-header eon-fg-h4">
      <eon-variable bind="locale.global.view" global="true"></eon-variable>
      <div class="separator"></div>
      <!-- <eon-variable bind="locale.global.default" global="true"></eon-variable> -->
    </div>
    <div class="tab-menu-content eon-fg2-hoverable eon-bg2-hoverable">
      <eon-variable bind="locale.home.tasksTitle" global="true" eon-ref="bubbleTasks"></eon-variable>
    </div>
    <div class="tab-menu-content eon-fg2-hoverable eon-bg2-hoverable">
      <eon-variable bind="locale.home.clockin" global="true" eon-ref="bubbleClockin"></eon-variable>
    </div>
  </app-toggle-menu>

  <!-- MASK -->
  <eon-mask>
    <div class="home-mask-container">
      <div class="mask-title-row home-mask-title-row">
        <div class="mask-title">
          <div class="mask-title eon-mask-background1"></div>
        </div>
        <div class="mask-button eon-mask-background1"></div>
      </div>

      <div class="home-mask-title">
        <div>
          <div class="mask-text mask-text-small eon-mask-background1"></div>
          <div class="mask-text eon-mask-background1"></div>
        </div>
        <div>
          <div class="mask-text mask-text-small eon-mask-background1"></div>
          <div class="mask-text eon-mask-background1"></div>
        </div>
      </div>

      <div class="home-mask-rect eon-mask-background1"></div>

      <div class="mask-row first-mask-row">
        <div class="home-mask-text eon-mask-background1"></div>
      </div>

      <div class="home-mask-row first-home-mask-row eon-mask-background1"></div>
      <div class="home-mask-row eon-mask-background1"></div>

      <div class="mask-row">
        <div class="home-mask-text eon-mask-background1"></div>
      </div>

      <div class="home-mask-row eon-mask-background1"></div>
      <div class="home-mask-row eon-mask-background1"></div>

      <div class="mask-row">
        <div class="home-mask-text eon-mask-background1"></div>
      </div>

      <div class="home-mask-row eon-mask-background1"></div>
      <div class="home-mask-row eon-mask-background1"></div>

      <div class="mask-row">
        <div class="home-mask-text eon-mask-background1"></div>
      </div>
  
      <div class="home-mask-row eon-mask-background1"></div>
      <div class="home-mask-row eon-mask-background1"></div>
    </div>
  </eon-mask>
</template>

<script>
  eon.element({
    name: "home-view",
    style: "home-view.css",
    themed: false,
    parse: true,
    dependencies: [
      "@ui/eon-scroll",
      "@ui/eon-dialog",
      "@ui/eon-swiper",
      "@ui/eon-radio",
      "@custom/app-places",
      "home-task",
      "attend-form"
    ],
    properties: {
    },
    privateProperties: {
      /*
      @property (private) {Object} _refs 
      @description Object with  references
      */
      refs: {
        value: {}
      },
      /*
      @property (private) {Object} _misc
      @description Object with useful information
      */
      misc: {
        value: {},
        reflect: false
      },
    },
    functions: {
      refresh: function () {
        var el = this;
        // TODO - Use in the first landing after wizard finished
        el.hideEonMask();

        // Get url params to redirect to a specific subsection
        if(getParameterByName("sub") == "clockin") {
          eon.onReady(function(){
            el._refs.swiper.slideTo(1);
          });
        }

        this._showContentMask();

        // Home view data
        el._loadTasksData(function (error, data) {
          if (!error) {
            el.onTransformed(function () {
              if(!el._misc.refreshing) {
                el._misc.refreshing = true;
                el._buildHome(data.status);
              }
            });
          }
        });

        if (session.data && session.data.currentWorkspaceId && session.data.id) {
          el.classList.remove("hide");
          el._loadSessionLastRegistry();
        } else {
          el.classList.add("hide");
        }
      },
      clear: function () {
        this._refs.pendingList.innerHTML = "";
        this._refs.inProgressList.innerHTML = "";

        this._refs.lists = {};
        this._refs.tasks = {};
        this._misc.userTasks = {};

        this._misc.listFns = {};
        this._misc.tasksFns = {};
        
        this._misc.inProgressListsCounter = 0;
        this._misc.pendingListsCounter = 0;
        this._misc.pendingCounter = 0;
        this._misc.inProgressCounter = 0;
        this._misc.total = 0;
      }
    },
    privateFunctions: {
      // @function _drawStatic (private)
      drawStatic: function () {
        var el = this;
        mask.hideViewMask("home");
        // Draw resume
        this._setupResume();
        // Draw progress bars
        this._updateTaskProgress();
        // Hide view mask after language loaded at least
        eon.onLocaleLoaded(function(){
          // Minimun mask time to avoid flickering
          setTimeout(function(){
            // Hide home mask
            el.hideEonMask();
          }, 100);
        });
      },
      // @function _showContentMask (private)
      showContentMask: function () {
        this._refs.homeSwiper.classList.add("hide");
        this._refs.mask.classList.remove("hide");
      },
      // @function _hideContentMask (private)
      hideContentMask: function () {
        this._refs.homeSwiper.classList.remove("hide");
        this._refs.mask.classList.add("hide");
      },
      // @function _addListener (private)
      addListener: function () {
        var el = this;
        var homeTask;

        // * RESTORE AFTER DATA MANAGEMENT UPDATE
        socket.onSocketTask(function (taskData) {
          // console.log("Task changes received from rest", taskData);
          homeTask = el._refs.tasks[taskData.id];

          if(homeTask) {
            var diffs = differ.compare(homeTask.data, taskData);
            // console.log("difs", diffs);
          }

        });
        socket.onSocketBoard(function (boardData) {
          // console.log("Board changes received from rest", boardData);
          // if (homeTask) {
            // homeTask.data = taskData;
            // homeTask.node.update(taskData);
          // }
        });
        socket.onSocketTaskDeleted(function (taskId) {
          // console.log("Task deleted", taskId);
          homeTask = el._refs.tasks[taskId];

          if (homeTask) {
            el._deleteTask(el._refs.lists[homeTask.listId], taskId, homeTask.data);
          }
        });
        socket.onSocketBoardDeleted(function (boardId) {
          // console.log("Board deleted", boardId);
          // if (homeTask) {
            // homeTask.data = taskData;
            // homeTask.node.update(taskData);
          // }
        });
        
      },
      /*
        @function (private) _loadTasksData
        @description Load user tasks data
        @param {Function} cb [load tasks data callback]
      */
      loadTasksData: function (cb) {
        readHome(session.data.id, function (error, data) {
          if (!error) {
            if (cb) {
              cb(null, data);
            }
          } else {
            if (cb) {
              cb(true);
            }
          }
        });
      },
      // @function _handlePointerDown(private)
      setupOvertimeDialog: function () {
        var el = this;

        el._refs.reopenWorkdayButton.addEventListener('click', function (e) {
          el._refs.overtimeDialog.close();
          el._reopen();
        }, false);

        el._refs.reopenWorkdayWithBreakButton.addEventListener('click', function (e) {
          el._refs.overtimeDialog.close();
          el._reopenWithBreak();
        }, false);

        el._refs.newWorkdayButton.addEventListener('click', function (e) {
          el._refs.overtimeDialog.close();
          el._register();
        }, false);

        el._refs.overtimeDialog.onClose(function (e) {
          setTimeout(function () {
            el._stopSliderLoadingAnimation();
          }, 1000);
        }, false);

      },
      /*
        @function (private) _buildHome
        @description Setup tasks home
        @param {Object} data [Projects tasks grouped by status and list]
      */
      buildHome: function (data) {
        var el = this;
        var tasksByList = {};
        var counter = 0;
        var listFragment = document.createDocumentFragment();
        var task, taskData, list, listData;

        this.clear();

        this._misc.userTasks = this._filterUserTasks(data);

        // Create in progress tasks when lists ready
        if(!this._misc.onInProgressListsReadyFn) {
          this._misc.onInProgressListsReadyFn = function(){
            el._createTasks("inProgress", this._misc.userTasks);
          }

          this.onInProgressListsReady(this._misc.onInProgressListsReadyFn);
        }
        // Create pending tasks when lists ready
        if(!this._misc.onPendingListsReadyFn) {
          this._misc.onPendingListsReadyFn = function(){
            el._createTasks("pending", this._misc.userTasks);
          }
          this.onPendingListsReady(this._misc.onPendingListsReadyFn);
        }

        // Create status lists
        this._createStatusLists("pending", this._misc.userTasks);
        this._createStatusLists("inProgress", this._misc.userTasks);

        this._updateResumeValues(this._misc.userTasks);
        this._updateTaskProgress(this._misc.userTasks);

        this._togglePlaceHolder(this._misc.userTasks);
        
        // Show the first status slide with any task
        this._showInitialSlide(this._misc.userTasks);
        this._hideContentMask();

        el._misc.refreshing = false;
      },
      /*
        @function (private) _filterUserTasks
        @description 
        @param {Object} data [Projects tasks grouped by status and list]
      */
      filterUserTasks: function (data) {
        var userTasks = {
          pending: {count: 0, listCount: 0, projects:{}},
          inProgress: {count: 0, listCount: 0, projects: {}}
        };

        for (var statusKey in data){
          var status = data[statusKey];
          // Ignore archived and done
          if(status && status.projects && userTasks[statusKey]) {
            for (var projectId in status.projects) {
              var project = status.projects[projectId];
              // Filter by workspace
              if (project && session.data.currentWorkspaceId == project.workspace) {
                for (var listId in project.lists) {
                  var list = project.lists[listId];
                  if(!isEmpty(list.tasks)) {
                    userTasks[statusKey].projects[projectId] =  userTasks[statusKey].projects[projectId] || {
                      name: project.name,
                      color: project.color,
                      id: projectId,
                      lists: {}
                    };
  
                    userTasks[statusKey].projects[projectId].lists[listId] = {
                      tasks: list.tasks,
                      type: statusKey,
                      name: list.name
                    }
  
                    userTasks[statusKey].count += Object.keys(list.tasks).length;
                    userTasks[statusKey].listCount++;
                  }
                };
              }
            }
          }
        };

        return userTasks;
      },
      /*
        @function (private) _updateTaskProgress
        @description Update tasks progress
        @param {Object} data [Projects tasks grouped by status and list]
      */
      updateTaskProgress: function (data) {
        var fragment = document.createDocumentFragment();

        this._refs.statusBars = this._refs.statusBars || {};

        this._createProgressBar(fragment, "inProgress");
        this._createProgressBar(fragment, "pending");

        this._updateTasksProgressValues(data);

        this._refs.progress.appendChild(fragment);
      },
      /*
        @function (private) {Object} _createProgressBar
        @description Create tasks progress bars
        @param {Object} fragment [Progress bars container]
        @param {Object} data [Projects tasks grouped by status and list]
      */
      createProgressBar: function (fragment, status) {
        // Create progress bar if there is at least one task and has not been created yet
        if (!this._refs.statusBars[status]) {
          var bar = document.createElement("div");
          bar.classList.add("progress-bar");

          this._refs.statusBars[status] = bar;
          fragment.appendChild(bar);
        }
      },
      /*
        @function (private) {Object} _updateTasksProgressValues
        @description Update tasks progress bars values 
      */
      updateTasksProgressValues: function (data) {
        var totalWidth = this._refs.progress.offsetWidth;

        // Pending bar width
        if (this._refs.statusBars.pending) {
          // Get bar space proportions
          this._refs.statusBars.pending.style.width = this._getBarProportion("pending", data) + "%";
          // this._refs.statusBars.pending.style.backgroundColor = "#039be5";
        }
        // In progress bar width
        if (this._refs.statusBars.inProgress) {
          this._refs.statusBars.inProgress.style.flexGrow = 1;
          // this._refs.statusBars.inProgress.style.backgroundColor = "#33b679";
        }
      },
      /*
        @function (private) {Object} _getBarProportion
        @description
        @param {String}
      */
      getBarProportion: function (status, data) {
        var value, total;
        if(data) {
          value = data[status].count;
          total = data.pending.count + data.inProgress.count;
        } else {
          value = this._misc[status + "Counter"];
          total = this._misc.total;
        }

        var percent = (value / total) * 100;

        return percent || 0;
      },
          /*
        @function (private) {Object} _togglePlaceHolder
        @description
      */
      togglePlaceHolder: function (data) {
        var total = data ? data.pending.count + data.inProgress.count : this._misc.total;
        
        if (!total) {
          if (!this._refs.placeHolder) {
            // Add place holder
            this._refs.placeHolder = createPlaceHolder(eon.locale.global.noTasks, "img/no-content/no-content.svg", eon.locale.global.noTasksTitle);
            this._refs.content.appendChild(this._refs.placeHolder);

            // Add new project cta
            var addProject = document.createElement("div");
            addProject.classList.add("add-new", "eon-fg0");
            addProject.addEventListener("click", function () {
              // TODO - Open new project dialog at projects view
              showView("projects");
            });
            addProject.innerText = eon.locale.projects.addNew;
            this._refs.placeHolder.appendChild(addProject);
          }
          this._refs.placeHolder.classList.remove("hide");
        } else if (this._refs.placeHolder) {
          // Remove place holder
          this._refs.placeHolder.classList.add("hide");
        }
      },
      /*
        @function (private) {Object} _createStatusLists
        @description Create a task list for a specific status
        @param {String} status [List status]
        @param {Object} data [Projects tasks grouped by status and list]
      */
      createStatusLists: function (status, data) {
        var project;
        for (var projectId in data[status].projects) {
          project = data[status].projects[projectId];
          this._printListsAsync(project.lists, status, project, data[status].listCount);
        };
      },
      /*
        @function (private) {Object} _printListsAsync
        @description 
      */
      printListsAsync: function (lists, status, project, listsLength) {
        var el = this;
        var listsKeys = Object.keys(lists);
        var length = listsKeys.length;
        var listData, listNode;
        var index = 0;
        this._misc.listFns = this._misc.listFns || {};
       
        this._misc.listFns[status] = function(i){
          listData = lists[listsKeys[i]];
         
          if(!isEmpty(listData.tasks)) {
            listNode = el._createList(project, listsKeys[i], listData);

            el._refs[listData.type + "List"].appendChild(listNode);
          }

          i++
          
          if (i < length) {
            setTimeout(function () {
              el._misc.listFns[status](i);
            }, 1);
          } else {
            if (status == "inProgress" && listsLength == el._misc.inProgressListsCounter) {
              eon.triggerCallback("onInProgressListsReady", el, el);
            } else if (status == "pending" && listsLength == el._misc.pendingListsCounter) {
              eon.triggerCallback("onPendingListsReady", el, el);
            }
          }
        }

        el._misc.listFns[status](0);
      },
      /*
        @function (private) {Object} _createTasks
        @description Create the tasks
      */
      createTasks: function (status, data) {
        var project;
       
        for (var projectId in data[status].projects) {
          project = data[status].projects[projectId];

          for (var listId in project.lists){
            var list = project.lists[listId];
            if(!isEmpty(list.tasks)) {
              this._printTasksAsync(this._refs.lists[listId], list.tasks, project.color, status);
            }
          };
        }
      },
      /*
        @function (private) {Object} _printTasksAsync
        @description 
      */
      printTasksAsync: function (listObj, tasks, color, status) {
        var el = this;
        var tasksKeys = Object.keys(tasks);
        var length = tasksKeys.length;
        var taskData, taskNode;
        this._misc.tasksFns = this._misc.tasksFns || {};

        this._misc.tasksFns[listObj.id] = function(taskData, index){
          taskNode = el._createTask(listObj, tasksKeys[index], taskData, {status: status, color: color});
          
          index++;

          taskNode.onReady(function () {
            if (index < length) {
              el._misc.tasksFns[listObj.id](tasks[tasksKeys[index]], index);
            }
          });
        }
        this._misc.tasksFns[listObj.id](tasks[tasksKeys[0]], 0);
      },
      /*
        @function (private) _setupResume
        @description Setup tasks status tab list
      */
      setupResume: function () {
        // Status labels
        this._refs.pending.label.innerHTML = eon.locale.home.pending;
        this._refs.inProgress.label.innerHTML = eon.locale.home.inProgress;

        this._updateResumeValues();
      },
      /*
        @function (private) _updateResumeValues
        @description 
      */
      updateResumeValues: function (data) {
        // Status tasks number
        if(data) {
          this._refs.pending.value.innerHTML = data.pending.count;
          this._refs.inProgress.value.innerHTML = data.inProgress.count;
        } else {
          this._refs.pending.value.innerHTML = this._misc.pendingCounter;
          this._refs.inProgress.value.innerHTML = this._misc.inProgressCounter;
        }
      },
      /*
        @function (private) {Object} _showInitialSlide
        @param {Object} data [Projects tasks grouped by status and list]
      */
      showInitialSlide: function (data) {
        var progressCounter = data ? data.inProgress.count : this._misc.inProgressCounter;
        var pendingCounter = data ? data.pending.count : this._misc.pendingCounter;
    
        // Show inProgress list
        if (progressCounter) {
          this._slideTo(0, "inProgress", progressCounter);
          this._refs.statusBars.inProgress.classList.add("active");
          this._refs.inProgress.classList.add("active");
          this._refs.statusBars.pending.classList.remove("active");
          this._refs.pending.classList.remove("active");
        } else if (pendingCounter) {
          this._slideTo(1, "pending", pendingCounter);
          this._refs.statusBars.pending.classList.add("active");
          this._refs.pending.classList.add("active");
        } else {
          // Counter is 0 - Deactivate bars
          this._refs.statusBars.pending.classList.remove("active");
          this._refs.statusBars.inProgress.classList.remove("active");
          this._refs.inProgress.classList.remove("active");
          this._refs.pending.classList.remove("active");
        }
      },
      setupTypeButtons: function () {
        var el = this;
        var slide;

        el._refs.typeButtons.break.addEventListener("click", function () {
          el._selectType("break", true, true);
          if (window.innerWidth <= eon.tabletWidth) {
            slide = el._misc.currentSlide - 1;
            slide = slide || 0;

            el._updateHistory(slide);
            el._refs.swiper.prev();
          }
        });

        el._refs.typeButtons.food.addEventListener("click", function () {
          el._selectType("food", true, true);
          if (window.innerWidth <= eon.tabletWidth) {
            slide = el._misc.currentSlide - 1;
            slide = slide || 0;

            el._updateHistory(slide);
            el._refs.swiper.prev();
          }
        });

        el._refs.typeButtons.absence.addEventListener("click", function () {
          el._selectType("absence", true, true);
          if (window.innerWidth <= eon.tabletWidth) {
            slide = el._misc.currentSlide - 1;
            slide = slide || 0;

            el._updateHistory(slide);
            el._refs.swiper.prev();
          }
        });

        el._refs.typeButtons.activity.addEventListener("click", function () {
          el._selectType("activity", false, true);
          if (window.innerWidth <= eon.tabletWidth) {
            slide = el._misc.currentSlide - 1;
            slide = slide || 0;

            el._updateHistory(slide);
            el._refs.swiper.prev();
          }
        });
      },
      setupForm: function () {
        var el = this;

        el._refs.eventForm._refs.attendView = el;

        el._refs.eventForm.onSubmit(function (error, event) {
          if (!error) {

            app.location(function (error, position) {
              if (!error) {

                // Checks if the new event will overlap another existing event
                var overlapsEvent = false;
                var events = el._misc.currentRegistry.events;
                var eventKeys = Object.keys(events);

                for (var i = 0; i < eventKeys.length; i++) {
                  if (Number(events[eventKeys[i]].entryUTC) < Number(event.data.entryUTC) && events[eventKeys[i]].exitUTC && events[eventKeys[i]].exitUTC != "Invalid Date" && Number(event.data.entryUTC) < Number(events[eventKeys[i]].exitUTC)) {
                    overlapsEvent = true;
                    break;
                  }
                }

                if (overlapsEvent) {
                  showInfoDialog(eon.locale.events.overlappingError);
                } else {

                  event.data.position = position;
                  event.data.type = el._misc.selectedType.type;
                  event.data.isBreak = el._misc.selectedType.isBreak;

                  updateRegistryEvent(session.data.currentWorkspaceId, session.data.id, el._misc.currentRegistry.id, { event: event.data }, function (error, data) {
                    if (!error) {
                      setTimeout(function () {
                        el.refresh();
                        el._updateHistory(1);
                        el._refs.swiper.slideTo(1);
                      }, 0);
                    }
                  });
                }

                // el.refresh();
              }
            });
          }
        });
      },
      // @function _handlePointerDown(private)
      handlePointerDown: function (e) {
        var el = this;
        el._misc.isPointerDown = true;
        el._misc.setupActionAreaEnter = true;
        el._misc.previousPointerPos = e.clientX;
        el._misc.thumbPos = el._misc.thumbPos || 0;
        el._refs.thumb.classList.add("attend-activeThumb");
        e.preventDefault();
        e.stopPropagation();
      },
      // @function _handlePointerMove(private)
      handlePointerMove: function (e) {
        var el = this;
        if (el._misc.isPointerDown && el._isPointerOnActionArea(e)) {

          if (el._misc.setupActionAreaEnter) {
            el._misc.previousPointerPos = e.clientX;
            el._misc.thumbPos = el._misc.thumbPos || 0;
            el._misc.setupActionAreaEnter = false;
          }

          if (!el._misc.setupActionAreaEnter) {
            var difference, limit;
            if (e.clientX > el._misc.previousPointerPos) {
              difference = e.clientX - el._misc.previousPointerPos;
              limit = el._refs.thumbWrapper.offsetWidth - el._refs.thumb.offsetWidth;
              el._misc.thumbPos = el._misc.thumbPos + difference;
              el._misc.thumbPos = el._misc.thumbPos > limit ? limit : el._misc.thumbPos;
            } else if (e.clientX < el._misc.previousPointerPos) {
              difference = el._misc.previousPointerPos - e.clientX;
              limit = 0;
              el._misc.thumbPos = el._misc.thumbPos - difference;
              el._misc.thumbPos = el._misc.thumbPos < limit ? limit : el._misc.thumbPos;
            }
            el._misc.previousPointerPos = e.clientX;
            el._updateSlider();
          }

        }
      },
      // @function _handlePointerUp(private)
      handlePointerUp: function (e) {
        var el = this;

        if (el._misc.isPointerDown) {
          var end = el._refs.thumbWrapper.offsetWidth - el._refs.thumb.offsetWidth - 50;
          el._misc.isPointerDown = false;
          if (el._misc.thumbPos >= end) {
            el._misc.slideEnd = true;
          } else {
            el._misc.slideEnd = false;
            el._slideBack();
          }

          if (el._misc.slideEnd) {
            eon.triggerCallback("onSlide", el, el, []);
          }

        }
      },
      // @function _updateSlider(private)
      updateSlider: function () {
        var el = this;
        el._refs.thumb.style.transform = "translate3d(" + el._misc.thumbPos + "px, 0, 0)";
        el._updateFloatingTextOpacity();
      },
      // @function _updateFloatingTextOpacity(private)
      updateFloatingTextOpacity: function () {
        var el = this;
        // We want the floating text to lose all its opacity when the thumb reaches its half trajectory 
        var limit = el._refs.thumbWrapper.offsetWidth / 2;
        var opacity;
        if (el._misc.thumbPos < limit) {
          opacity = 1 - (el._misc.thumbPos / limit);
          el._refs.floatingText.style.opacity = opacity;
        }
      },
      // @function _isPointerOnActionArea(private)
      isPointerOnActionArea: function (e) {
        var el = this;
        var thumbWrapperClientRect = el._refs.thumbWrapper.getBoundingClientRect();
        return e.clientX > thumbWrapperClientRect.left && e.clientX < thumbWrapperClientRect.right;
      },
      // @function _slideBack(private)
      slideBack: function () {
        var el = this;
        var initial = advance = el._misc.thumbPos;
        var duration = Math.min(1200, Math.abs(advance) * 2);
        var endTime = + new Date() + duration;
        var finished, rate, proportion;
        // If there is a previous animation frame still running we cancel it
        cancelAnimationFrame(el._misc.slideBackAnimationFrame);
        // Creates the function that will scroll until it reached the desired position
        el._misc.slideBackFn = function () {
          var currentTime = +new Date();
          var remaining = (endTime - currentTime);
          rate = 1 - Math.pow(remaining / duration, 3);
          rate = rate > 1 ? 1 : rate;
          proportion = rate * advance;

          // If there is place for us to scroll
          if (el._misc.thumbPos > 0) {
            el._misc.thumbPos = initial - proportion;
            el._misc.thumbPos = el._misc.thumbPos < 0 ? 0 : el._misc.thumbPos;
            el._updateSlider();
            // Once it finishes sets the finished variable to true
          } else {
            finished = true;
          }
          // Keeps running the animation frame until it finishes
          if (!finished) {
            el._misc.slideBackAnimationFrame = requestAnimationFrame(el._misc.slideBackFn);
          } else {
            el._refs.thumb.classList.remove("attend-activeThumb");
            cancelAnimationFrame(el._misc.slideBackAnimationFrame);
          }
        };
        // Inits the requestAnimationFrame
        el._misc.slideBackAnimationFrame = window.requestAnimationFrame(el._misc.slideBackFn);
      },
      // @function _loadSessionLastRegistry(private)
      loadSessionLastRegistry: function () {
        var el = this;
        var url = "/rest/registry/" + session.data.currentWorkspaceId + "/" + session.data.id + "/last";
        var payloadObj = { "userId": session.data.id };
        eon.ajax(url, { method: "GET", contentType: "application/json", payload: JSON.stringify(payloadObj) }, function (error, data) {
          if (!error) {
            var responseObj = JSON.parse(data.responseText);
            if (!responseObj.isExpired) {
              el._fillRegistry(data);
            } else {
              el._resetRegistry();
            }
          } else if (data.status == 401) {
            session.logout();
          }
        });
      },
      // @function _requestRegistration(private)
      requestRegistration: function () {
        var el = this;
        var url = "/rest/registry/" + session.data.currentWorkspaceId + "/" + session.data.id + "/last";

        app.requestLocationPermission(function () {
          el._startSliderLoadingAnimation();

          app.location(function (error, position) {
            if (!error) {

              var payloadObj = { "userId": session.data.id };

              eon.ajax(url, { method: "GET", contentType: "application/json", payload: JSON.stringify(payloadObj) }, function (error, data) {

                if (!error) {

                  var responseObj = JSON.parse(data.responseText);
                  var hasToOpenAlert = !eon.util.isTrue(responseObj.isExpired) && !eon.util.isTrue(responseObj.sameDayNewWorkday) && !eon.util.isTrue(responseObj.reopenWorkday) && !eon.util.isTrue(responseObj.reopenWorkdayFromNow);

                  if (responseObj.status === "out" && hasToOpenAlert) {
                    showInfoDialog(eon.locale.home.alert.cannotRegister);
                    setTimeout(function () {
                      el._stopSliderLoadingAnimation();
                    }, 1000);
                  } else if (responseObj.status === "out" && !eon.util.isTrue(responseObj.isExpired)) {

                    el._refs.reopenWorkdayButton.style.display = eon.util.isTrue(responseObj.reopenWorkday) ? "block" : "none";
                    el._refs.reopenWorkdayWithBreakButton.style.display = eon.util.isTrue(responseObj.reopenWorkdayFromNow) ? "block" : "none"
                    el._refs.newWorkdayButton.style.display = eon.util.isTrue(responseObj.sameDayNewWorkday) ? "block" : "none"

                    el._refs.overtimeDialog.open();
                    // Push dialog state
                    pushDialogState(el._refs.overtimeDialog);
                  } else {
                    el._register();
                  }

                } else if (data.status == 401) {
                  session.logout();
                } else {
                  if (data.status == 400) {
                    showInfoDialog(eon.locale.home.alert.invalidPosition);
                  }
                  el._displayLoadingError();
                }

              });

            } else {
              el._displayLoadingError();
            }
          });
        });
      },
      // @function _register(private)
      register: function () {
        var el = this;
        var url = "/rest/registry/" + session.data.currentWorkspaceId + "/" + session.data.id;
        var date = new Date();
        var tzOffset = date.getTimezoneOffset();

        el._startSliderLoadingAnimation();

        app.location(function (error, position) {
          if (!error) {

            var payloadObj = { position: position, tzOffset: tzOffset };

            eon.ajax(url, { method: "POST", contentType: "application/json", payload: JSON.stringify(payloadObj) }, function (error, data) {

              setTimeout(function () {
                if (!error) {
                  el._fillRegistry(data);
                } else if (data.status == 401) {
                  session.logout();
                } else {

                  if (data.status == 400) {
                    showInfoDialog(eon.locale.home.alert.invalidPosition);
                  }

                  el._displayLoadingError();
                }
              }, 1000);

            });

          } else {
            el._displayLoadingError();
          }
        });
      },
      // @function _reopen(private)
      reopenWithBreak: function () {
        var el = this;
        var url = "/rest/registry/" + session.data.currentWorkspaceId + "/" + session.data.id + "/reopenWithBreak";

        app.location(function (error, position) {
          if (!error) {

            var payloadObj = { position: position };

            eon.ajax(url, { method: "POST", contentType: "application/json", payload: JSON.stringify(payloadObj) }, function (error, data) {

              setTimeout(function () {
                if (!error) {
                  el._fillRegistry(data);
                } else if (data.status == 401) {
                  session.logout();
                } else {
                  if (data.status == 400) {
                    showInfoDialog(eon.locale.home.alert.invalidPosition);
                  }
                  el._displayLoadingError();
                }
              }, 1000);

            });

          } else {
            el._displayLoadingError();
          }
        });

      },
      // @function _reopen(private)
      reopen: function () {
        var el = this;
        var url = "/rest/registry/" + session.data.currentWorkspaceId + "/" + session.data.id + "/reopen";

        app.location(function (error, position) {
          if (!error) {

            var payloadObj = { position: position };

            eon.ajax(url, { method: "POST", contentType: "application/json", payload: JSON.stringify(payloadObj) }, function (error, data) {

              setTimeout(function () {
                if (!error) {
                  el._fillRegistry(data);
                } else if (data.status == 401) {
                  session.logout();
                } else {
                  if (data.status == 400) {
                    showInfoDialog(eon.locale.home.alert.invalidPosition);
                  }
                  el._displayLoadingError();
                }
              }, 1000);

            });

          } else {
            el._displayLoadingError();
          }
        });

      },
      // @function _fillRegistry(private)
      fillRegistry: function (data) {
        var el = this;
        var responseObj = JSON.parse(data.responseText);

        el._misc.currentRegistry = responseObj;
        el._misc.breaks = null;
        el._misc.currentEvent = null;

        el._fillTimeline(responseObj);

        el._updateStatus(responseObj);
        el._updateBreaks(responseObj.events);
        el._updateWorkedTime(responseObj.status);

        el._stopSliderLoadingAnimation();
        el._refs.timelineScroll.scrollTop = el._refs.timelineScroll.scrollTopEnd;

      },
      // @function _fillTimeline(private)
      fillTimeline: function (registry) {
        var el = this;
        var events = registry.events ? Object.keys(registry.events) : [];
        var eventsFragment = document.createDocumentFragment();
        var entryEvent, event, eventCreationButton, exitEvent;

        el._refs.timeline.innerHTML = "";

        entryEvent = el._createEntryEvent(registry);
        exitEvent = el._createExitEvent(registry);
        eventCreationButton = el._createEventCreationButton(registry);

        eventsFragment.appendChild(entryEvent);

        events.sort()

        for (var i = 0; i < events.length; i++) {
          event = el._createEvent(registry.events[events[i]], true);
          eventsFragment.appendChild(event);
        }

        eventsFragment.appendChild(eventCreationButton);
        eventsFragment.appendChild(exitEvent);

        el._refs.timeline.appendChild(eventsFragment);

        el._prepareAutoRefresh();

      },
      prepareAutoRefresh: function () {
        var el = this;
        var nextRefreshTime = el._getNextRefreshTime();
        var currentTime = moment().valueOf();

        if (nextRefreshTime) {

          var upcomingEvent = el._getUpcomingEvent();

          clearTimeout(el._misc.autoRefreshTimeout);

          el._misc.autoRefreshTimeout = setTimeout(function () {
            if (el._misc.currentEvent && upcomingEvent && currentTime >= upcomingEvent.entryUTC) {
              el._exitEvent(el._misc.currentEvent, upcomingEvent.entryUTC);
            }
            el.refresh();
            el._updateHistory(1);
            el._refs.swiper.slideTo(1);
          }, nextRefreshTime - currentTime);
        }
      },
      getNextRefreshTime: function () {
        var el = this;
        var events = el._misc.currentRegistry && el._misc.currentRegistry.events ? Object.keys(el._misc.currentRegistry.events) : [];
        var times = [];
        var currentTime = moment().valueOf();
        var event, currentTimeIndex, nextEventTime, nextRefreshTime;

        for (var i = 0; i < events.length; i++) {
          event = el._misc.currentRegistry.events[events[i]];
          times.push(moment(Number(event.entryUTC)).valueOf());
          if (event.exitUTC) {
            times.push(moment(Number(event.exitUTC)).valueOf());
          }
        }

        if (times.length > 0) {
          times.push(currentTime);
          times.sort();

          currentTimeIndex = times.indexOf(currentTime);

          if (currentTimeIndex < (times.length - 1)) {
            nextRefreshTime = times[currentTimeIndex + 1];
          }
        }

        return nextRefreshTime;
      },
      getUpcomingEvent: function () {
        var el = this;
        var events = Object.keys(el._misc.currentRegistry.events);
        var times = [];
        var currentTime = moment().valueOf();
        var event, currentTimeIndex, nextEventTime, upcomingEvent;

        events.push(currentTime);
        events.sort();

        currentTimeIndex = events.indexOf(currentTime);

        if (currentTimeIndex < (events.length - 1)) {
          upcomingEvent = el._misc.currentRegistry.events[events[currentTimeIndex + 1]];
        }

        return upcomingEvent;
      },
      // @function _getBreakEvents (private)
      getBreakEvents: function (events) {
        var breaks = [];
        var eventKeys = Object.keys(events);
        eventKeys.sort();
        for (var i = 0; i < eventKeys.length; i++) {
          if (events[eventKeys[i]].isBreak) {
            breaks.push(events[eventKeys[i]]);
          }
        }
        return breaks;
      },
      createEntryEvent: function (registry) {
        var el = this;
        var entryEvent = {
          type: "entry",
          entryUTC: registry.entryUTC
        }
        return el._createEvent(entryEvent, false);
      },
      createExitEvent: function (registry) {
        var el = this;
        var exitEvent = {
          type: "exit",
          exitUTC: registry.exitUTC,
          defaultExit: registry.defaultExit
        }
        return el._createEvent(exitEvent, false);
      },
      createEventCreationButton: function (registry) {
        var el = this;
        var event = document.createElement("div");
        var content = document.createElement("div");
        var iconWrapper = document.createElement("div");
        var icon = document.createElement("div");
        var data = document.createElement("eon-variable");
        var line = document.createElement("div");

        event.classList.add("attend-timeline-event", "attend-timeline-addEvent");
        content.classList.add("attend-timeline-content");
        iconWrapper.classList.add("attend-timeline-iconWrapper");
        icon.classList.add("attend-timeline-icon", "vicon", "vicon-add");
        data.classList.add("attend-timeline-data");
        line.classList.add("attend-timeline-line", "eon-bg1-border");

        data.setAttribute("global", "true");
        data.setAttribute("bind", "locale.events.addEvent");

        if (registry.exitUTC || !registry.status) {
          event.classList.add("attend-timeline-hidden");
        } else if (registry.isExpired) {
          event.classList.add("attend-timeline-disabled");
        }

        content.addEventListener("click", function () {
          // Hide remove event button
          el._refs.eventForm._refs.remove.classList.add("hide");

          var highlightTypeButton = window.innerWidth <= eon.tabletWidth ? false : true;

          el._misc.isEditing = false;
          el._selectType("break", true, highlightTypeButton);

          el._updateHistory(2);
          el._refs.swiper.slideTo(2);
          el._refs.eventForm.clear();
        });

        iconWrapper.appendChild(icon);

        content.appendChild(iconWrapper);
        content.appendChild(data);

        event.appendChild(line);
        event.appendChild(content);

        return event;
      },
      createEvent: function (eventData, editable) {
        var el = this;
        var event = document.createElement("div");
        var content = document.createElement("div");
        var iconWrapper = document.createElement("div");
        var icon = document.createElement("div");
        var data = document.createElement("div");
        var type = document.createElement("eon-variable");
        var time = document.createElement("div");
        var line = document.createElement("div");

        var typeIcon = getEventTypeIcon(eventData.type);
        var currentTime = moment().valueOf();

        var start, exit, timeString, label;

        event.classList.add("attend-timeline-event");
        content.classList.add("attend-timeline-content");
        iconWrapper.classList.add("attend-timeline-iconWrapper");
        icon.classList.add("attend-timeline-icon", "vicon", typeIcon, "eon-bg1");
        data.classList.add("attend-timeline-data");
        type.classList.add("attend-timeline-type");
        time.classList.add("attend-timeline-time");
        line.classList.add("attend-timeline-line", "eon-bg1-border");

        // entry 'business icon' style correction
        if (eventData.type == "entry") {
          icon.classList.add("entry-icon-fix");
        }

        label = !eon.locale.events[eventData.type] ? "locale." : "locale.events.";

        type.setAttribute("global", "true");
        type.setAttribute("bind", label + eventData.type);

        data.appendChild(type);
        data.appendChild(time);

        iconWrapper.appendChild(icon);

        content.appendChild(iconWrapper);
        content.appendChild(data);

        if (eventData.type == "entry" || eventData.exitUTC && eventData.exitUTC < currentTime) {
          event.classList.add("attend-pastEvent");
        }

        if (editable) {
          var buttonsWrapper = document.createElement("div");
          var edit = document.createElement("div");
          var stop = document.createElement("div");

          buttonsWrapper.classList.add("attend-timeline-buttonsWrapper");
          edit.classList.add("attend-timeline-editButton", "vicon", "ticon-edit");
          stop.classList.add("attend-timeline-stopButton", "vicon", "vicon-stop");

          buttonsWrapper.appendChild(edit);
          buttonsWrapper.appendChild(stop);

          edit.addEventListener("click", function () {
            el._misc.isEditing = true;

            // Show remove event button
            el._refs.eventForm._refs.remove.classList.remove("hide");
            el._refs.eventForm._misc.currentRegistry = el._misc.currentRegistry;
            el._selectType(eventData.type, eventData.isBreak, true);
            el._refs.eventForm.editEvent(eventData);
            el._updateHistory(2);
            el._refs.swiper.slideTo(2);
          });

          if (eventData.entryUTC < currentTime && (currentTime < eventData.exitUTC || !eventData.exitUTC)) {

            var spinner = document.createElement("div");
            spinner.classList.add("attend-currentEventloader", "eon-bg1-gradient");
            iconWrapper.appendChild(spinner);


            el._misc.currentEvent = eventData;

            stop.addEventListener("click", function () {
              el._exitEvent(eventData);
            });

          } else {
            stop.classList.add("attend-timeline-hidden");
          }

          content.appendChild(buttonsWrapper);
        }

        event.appendChild(line);
        event.appendChild(content);

        if (eventData.type == "entry") {
          timeString = eventData.entryUTC ? moment(Number(eventData.entryUTC)).format("HH:mm") : "";
        } else if (eventData.type == "exit") {
          timeString = eventData.exitUTC ? moment(Number(eventData.exitUTC)).format("HH:mm") : moment(Number(eventData.defaultExit)).format("HH:mm");
          timeString = !eventData.exitUTC && !eventData.defaultExit ? "" : timeString;
        } else {
          start = eventData.entryUTC ? moment(Number(eventData.entryUTC)).format("HH:mm") : "";
          exit = eventData.exitUTC ? moment(Number(eventData.exitUTC)).format("HH:mm") : null;
          timeString = exit ? start + " - " + exit : start;
        }

        if ((eventData.type == "entry" && eventData.entryUTC) || eventData.entryUTC && (currentTime > eventData.entryUTC) || (eventData.type == "exit" && eventData.exitUTC)) {
          event.classList.add("attend-timeline-activeEvent");
        }

        time.innerHTML = timeString;

        return event;
      },

      exitEvent: function (eventData, exitTime) {
        var el = this;

        var entryTime = eventData.entryUTC;
        eventData.entryUTC = moment.utc(moment(Number(entryTime).valueOf())).valueOf();

        exitTime = !exitTime ? moment().valueOf() : exitTime;
        eventData.exitUTC = moment.utc(moment(Number(exitTime).valueOf())).valueOf();

        eventData.key = eventData.entryUTC;

        updateRegistryEvent(session.data.currentWorkspaceId, session.data.id, el._misc.currentRegistry.id, { event: eventData }, function (error, data) {
          if (!error) {
            // Update registry grid
            setTimeout(function () {
              el.refresh();
            }, 0);
          } else {
            // errorText = eon.locale.registry.createFail;
            // showInfoDialog(errorText);
          }
        });
      },
      selectType: function (type, isBreak, highlight) {
        var el = this;
        var typeIcon = getEventTypeIcon(type);
        var previousIcon = el._misc.selectedType ? getEventTypeIcon(el._misc.selectedType.type) : null;

        el._misc.selectedType = {};

        el._misc.selectedType.type = type;
        el._misc.selectedType.isBreak = isBreak;

        // In case we were creating a new event and the form was being hidden we unhide it

        if (highlight) {
          el._highlightTypeButton(type);
        } else {
          // Passing null removes the highlight from the type button
          el._highlightTypeButton(null);
        }

        if (previousIcon) {
          el._refs.currentTypeIcon.classList.remove(previousIcon);
        }

        el._refs.currentTypeIcon.classList.add(typeIcon);
        el._refs.currentTypeLabel.innerHTML = eon.locale.events[type];

      },
      highlightTypeButton: function (type) {
        var el = this;
        var selectedTypeButton = el.querySelector(".attend-event-type.selected");
        var newTypeButton = el._refs.typeButtons[type];

        if (selectedTypeButton) {
          selectedTypeButton.classList.remove("selected");
          // selectedTypeButton.classList.remove("eon-fg0");
        }

        if (newTypeButton) {
          newTypeButton.classList.add("selected");
          // newTypeButton.classList.add("eon-fg0");
        }

      },
      // @function _updateWorkedTime(private)
      updateWorkedTime: function (status) {

        var el = this;

        if (el._misc.currentRegistry) {

          var workTimeLimit;
          var registryEntry = moment(Number(el._misc.currentRegistry.entryUTC)).valueOf();

          status = el._misc.currentStatus;

          if (status == "break" || status == "out") {

            workTimeLimit = status == "break" ? moment(Number(el._misc.currentEvent.entryUTC)).valueOf() : moment(Number(el._misc.currentRegistry.exitUTC)).valueOf();

            el._refreshWorkedTime(moment(workTimeLimit).diff(registryEntry));
            el._misc.workedTimeAutoRefresh = false;

          } else {

            el._refreshWorkedTime(moment(Number(Date.now())).diff(registryEntry));
            el._misc.workedTimeAutoRefresh = true;

          }

        }

      },
      refreshWorkedTime: function (workTime) {
        var el = this;
        var now, breakStart, breakExit, breakDuration;

        if (el._misc.breaks) {
          for (var i = 0; i < el._misc.breaks.length; i++) {

            now = moment().valueOf();
            breakStart = moment(Number(el._misc.breaks[i].entryUTC)).valueOf();
            breakExit = moment(Number(el._misc.breaks[i].exitUTC)).valueOf();
            breakDuration = moment(breakExit).diff(breakStart);

            if (el._misc.breaks[i].exitUTC && breakExit < now) {
              workTime = workTime - breakDuration;
            }

          }
        }

        el._refs.workedTimeValue.innerHTML = moment.duration(workTime, "milliseconds").format("HH:mm:ss", {
          trim: false
        });

      },
      // @function _resetRegistry(private)
      resetRegistry: function () {

        var el = this;
        var member, customObj;

        el._misc.currentRegistry = null;
        el._misc.breaks = null;
        el._misc.currentEvent = null;
        el._misc.workedTimeAutoRefresh = false;

        el._refs.slider.classList.remove("attend-disabled");

        if (session.isAdmin()) {
          readWorkspace(session.data.currentWorkspaceId, function (error, data) {
            if (!error) {
              // Update session
              session.data.currentWorkspace = data;

              member = data.members[session.data.id];
              customObj = {
                entryUTC: member.startTime ? member.startTime : null,
                exitUTC: member.endTime ? member.endTime : null
              }
              el._fillTimeline(customObj);
            }
          });
        } else {
          el._fillTimeline({});
        }

        el._refs.slider.style.width = "100%";

        eon.locale.home.slideMessage = eon.locale.home.startRegistry;
        el._refs.timelineScroll.scrollTop = el._refs.timelineScroll.scrollTopEnd;

      },
      // @function _updateStatus(private)
      updateStatus: function (registry) {
        var el = this;
        var exitClassAction, isOnBreak;

        if (registry.status) {

          isOnBreak = el._isOnBreak();
          exitClassAction = registry.status === "in" || isOnBreak ? "add" : "remove";
          el._misc.currentStatus = isOnBreak ? "break" : registry.status;
          eon.locale.home.slideMessage = el._misc.currentStatus === "in" || isOnBreak ? eon.locale.home.closeRegistry : eon.locale.home.startRegistry;

        } else {

          exitClassAction = "remove";
          el._misc.currentStatus = "out";
          eon.locale.home.slideMessage = eon.locale.home.startRegistry;

        }

        el._refs.slider.classList[exitClassAction]("attend-slider-exit");

      },
      isOnBreak: function () {
        var el = this;
        var registry = el._misc.currentRegistry;
        var isOnBreak = false;
        var eventKeys = Object.keys(registry.events);
        var now = moment().valueOf();
        var brk, brkEntry, brkExit;

        if (registry.status == "in") {
          for (var i = 0; i < eventKeys.length; i++) {

            brk = registry.events[eventKeys[i]];
            brkEntry = brk.entryUTC ? moment(Number(brk.entryUTC)).valueOf() : null;
            brkExit = brk.exitUTC ? moment(Number(brk.exitUTC)).valueOf() : null;

            if (brk.isBreak && ((brkEntry < now && brkExit > now) || brkEntry < now && !brkExit)) {
              isOnBreak = true;
            }

          }
        }

        return isOnBreak;
      },
      // @function _updateBreaks(private)
      updateBreaks: function (events) {
        var el = this;
        el._misc.breaks = [];
        if (events) {
          var eventKeys = Object.keys(events);
          for (var i = 0; i < eventKeys.length; i++) {
            if (events[eventKeys[i]].isBreak) {
              el._misc.breaks.push(events[eventKeys[i]]);
            }
          }
        }
      },
      // @function _startSliderLoadingAnimation(private)
      startSliderLoadingAnimation: function () {

        var el = this;

        window.cancelAnimationFrame(el._misc.stopAnimationFrame);

        el._refs.floatingText.style.opacity = "0";
        el._refs.thumb.style.opacity = "0";

        el._refs.sliderLoadingRotator.style.opacity = 1;
        el._refs.slider.style.width = "60px";
        el._refs.slider.style.flexGrow = "0";

      },
      // @function _stopSliderLoadingAnimation(private)
      stopSliderLoadingAnimation: function () {

        var el = this;

        window.cancelAnimationFrame(el._misc.stopAnimationFrame);

        el._refs.slider.style.width = "100%";
        el._refs.slider.style.flexGrow = "1";

        el._refs.thumb.style.transform = "translate3d(0px, 0px, 0px)";
        el._refs.thumb.classList.remove("attend-activeThumb");
        el._misc.thumbPos = 0;

        // Removes error style in case an error has occurred
        el._refs.slider.classList.remove("attend-sliderError");
        el._refs.sliderErrorCross.style.opacity = 0;

        el._refs.sliderLoadingRotator.style.opacity = 0;

        var previousWidth = el._refs.slider.offsetWidth;
        var initialWidth = el._refs.slider.offsetWidth;

        function widthWatcher(timestamp) {

          if (initialWidth === el._refs.slider.offsetWidth || previousWidth !== el._refs.slider.offsetWidth) {

            previousWidth = el._refs.slider.offsetWidth;
            el._misc.stopAnimationFrame = window.requestAnimationFrame(widthWatcher);

          } else {

            el._refs.floatingText.style.opacity = "1";
            el._refs.thumb.style.opacity = "1";

          }

        }

        el._misc.stopAnimationFrame = window.requestAnimationFrame(widthWatcher);

      },
      // @function _displayLoadingError(private)
      displayLoadingError: function () {
        var el = this;

        el._refs.slider.classList.add("attend-sliderError");
        el._refs.sliderLoadingRotator.style.opacity = 0;
        el._refs.sliderErrorCross.style.opacity = 1;

        setTimeout(function () {
          el._stopSliderLoadingAnimation();
        }, 1000);
      },

      /*
        @function (private) _toggleView
        @description
      */
      toggleView: function () {
        var el = this;
        // TODO - Display view from history state
        el._misc.currentSlide = 0;

        if (window.innerWidth <= eon.tabletWidth) {
          el._refs.eventTypeSlide.appendChild(el._refs.eventTypes);
        } else {
          el._refs.eventSlideContent.insertBefore(el._refs.eventTypes, el._refs.eventForm);
          el._refs.currentType.style.display = "none";
        }
      },
      /*
        @function (private) _mainListener
        @description
      */
      mainListener: function () {
        var el = this;
        var removeButtons = document.querySelectorAll(".attend-event-remove");

        el._refs.currentType.addEventListener("click", function () {
          var slide = el._misc.currentSlide + 1;
          slide = slide || 0;

          el._updateHistory(slide);
          el._refs.swiper.next();
        });

        for (var i = 0; i < removeButtons.length; i++) {
          removeButtons[i].addEventListener("click", function () {
            deleteRegistryEvent(session.data.currentWorkspaceId, session.data.id, el._misc.currentRegistry.id, el._refs.eventForm._misc.eventKey, function (error, data) {
              if (!error) {
                setTimeout(function () {
                  el.refresh();
                  el._updateHistory(1);
                  el._refs.swiper.slideTo(1);
                }, 0);
              } else {
                // errorText = eon.locale.registry.createFail;
                // showInfoDialog(errorText);
              }
            });
          });
        }

        // REMOVE DIALOG
        el._refs.confirmRemove.addEventListener("click", function () {
          deleteRegistryEvent(session.data.currentWorkspaceId, session.data.id, el._misc.currentRegistry.id, el._refs.eventForm._misc.eventKey, function (error, data) {
            if (!error) {
              setTimeout(function () {
                el.refresh();
                el._updateHistory(1);
                el._refs.swiper.slideTo(1);
              }, 0);
            } else {
              // errorText = eon.locale.registry.createFail;
              // showInfoDialog(errorText);
            }
          });
          el._refs.removeDialog.close();
        });

        el._refs.cancelRemove.addEventListener("click", function () {
          el._refs.removeDialog.close();
        });
      },
      /*
        @function (private) _socketListener
        @description
      */
      // @function _socketListeners (private)
      socketListener: function () {
        var el = this;

        this.onSocketUpdate(function (action) {
          // Update status resume
          el._togglePlaceHolder();
          el._updateResumeValues();
          el._updateTasksProgressValues();
          if(!~["update"].indexOf(action)){
            el._showInitialSlide();
          }
        });

        session.onReady(function () {
          // * To be replaced with callbacks since socket comunication will be implemented globally
          app.socket.on("task", function (socketData) {
            // Do nothing if the changes are from the same session
            var taskData = socketData.task;
            // Check if the task exist in this session
            switch (socketData.action) {
              case "update":
                // * Replaced with onTask_update callback
                el._updateTask(taskData.id, taskData);
                break;
              case "move":
                el._moveTask(taskData.id, taskData);
                break;
              case "create":
                el._createTask(el._refs.lists[taskData.listId], taskData.id, taskData);
                break;
              case "delete":
                // * TODO Replaced with onTask_delete callback
                el._deleteTask(el._refs.lists[taskData.listId], taskData.id, taskData);
                break;
            }
          });
        });
      },
      /*
        @function (private) _navigationListener
        @description
      */
      navigationListener: function () {
        var el = this;

        // Add state listener
        window.addEventListener("popstate", function (e) {
          if (e.state && (e.state.sub || e.state.sub == 0)) {
            // Get subsection index
            el._refs.swiper.slideTo(e.state.sub);
          }
        });

        el._updateHistory(0, window.location.pathname);

        el._refs.swiper.onSlideChange(function (prevSlide, currentSlide) {
          // Hiding form slide when creating event and sliding to second slide
          if (window.innerWidth <= eon.tabletWidth) {
            if (currentSlide == 0) {
              el._refs.formSlide.style.opacity = "0";
            } else if (currentSlide == 1) {
              el._refs.formSlide.style.opacity = "1";
            }
          }

          // Display/hide navigation buttons
          if (currentSlide == 0) {
            el._showView("tasks");
          } else {
            el._showView("clockin");
          }

          el._misc.currentSlide = currentSlide;
        });

        el._refs.tasksTab.addEventListener("click", function () {
          el._updateHistory(0);
          el._refs.swiper.slideTo(0);
        });
      },
      /*
        @function (private) _showView
        @description
      */
      showView: function (view) {
        switch (view) {
          case "tasks":
            this._refs.tasksTab.classList.add("eon-fg1-active");
            this._refs.clockinTab.classList.remove("eon-fg1-active");
            this._refs.title.innerHTML = eon.locale.home.tasksTitle;
            this.$1(".tab-menu-button > .tab-menu-label").innerHTML = eon.locale.home.tasksTitle;
            this.$1(".tab-menu-button :first-child").className = "ticon ticon-tasks";
            break;
            case "clockin":
              this._refs.tasksTab.classList.remove("eon-fg1-active");
              this._refs.clockinTab.classList.add("eon-fg1-active");
              this._refs.title.innerHTML = eon.locale.home.clockin;
              this.$1(".tab-menu-button > .tab-menu-label").innerHTML = eon.locale.home.clockin;
              this.$1(".tab-menu-button :first-child ").className = "ticon ticon-clocking";
              break;
            }
          },
          /*
        @function (private) _updateHistory
        @description
      */
      updateHistory: function (slide, view) {
        var url = window.location.href.split("#")[0];
        view = view || this._misc.view || "/app/home";
        this._misc.view = view;

        if (slide == 0) {
          window.history.pushState({
            view: view,
            sub: slide
          }, slide, url);
        } else {
          window.history.pushState({
            view: view,
            sub: slide
          }, slide, url + "#" + slide);
        }
      },
      /*
        @function (private) _setupHome
        @description
      */
      setupHome: function () {
        this._refs.lists = {};
        this._refs.tasks = {};

        this._misc.pendingCounter = 0;
        this._misc.inProgressCounter = 0;

        this._misc.total = 0;

        this._misc.colors = {
          pending: "#039be5",
          inProgress: "#33b679"
        }

        // Setup menus
        this._refs.bubbleMenu.layout = this;
        this._refs.bubbleMenu.layoutHeight = this._refs.viewSelector;
      },
      /*
        @function (private) _homeListener
        @description
      */
      homeListener: function () {
        var el = this;

        el._refs.inProgress.addEventListener("click", el._slideTo.bind(el, 0, "inProgress", null));
        el._refs.pending.addEventListener("click", el._slideTo.bind(el, 1, "pending", null));
      },
      /*
        @function (private) _slideTo
        @description
      */
      slideTo: function (slideIdx, status, counter) {
        var el = this;

        this.onTransformed(function () {
          // Check status counter
          counter = !counter && counter !== 0 ? el._misc[status + "Counter"] : counter;
          
          if (counter) {
            el._refs.homeSwiper.slideTo(slideIdx);

            for (var key in el._refs.statusBars) {
              var bar = el._refs.statusBars[key];
              if (key == status) {
                el._refs.statusBars[key].classList.add("active");
                el._refs[key].classList.add("active");
              } else {
                el._refs.statusBars[key].classList.remove("active");
                el._refs[key].classList.remove("active");
              }
            };
          }
        });
      },
      /*
        @function (private) _bubbleListener
        @description
      */
      bubbleListener: function () {
        var el = this;

        this._refs.bubbleTasks.addEventListener("click", function (e) {
          el._updateHistory(0);
          el._refs.swiper.slideTo(0);
          el._refs.bubbleMenu.close();
        });
        this._refs.bubbleClockin.addEventListener("click", function (e) {
          el._updateHistory(1);
          el._refs.swiper.slideTo(1);
          el._refs.bubbleMenu.close();
        });

        this._refs.viewSelector.addEventListener("click", function (e) {
          // Display menu          
          el._refs.bubbleMenu.open();
          // Push dialog state
          pushDialogState(el._refs.bubbleMenu);
        });
        this._refs.clockinTab.addEventListener("click", function (e) {
          el._updateHistory(1);
          el._refs.swiper.slideTo(1);
        });
      },
      /*
        @function (private) _createList
        @description
      */
      createList: function (board, listId, list) {
        var listNode, project, list, listHead, listContent, headChevron, projectLabel, listLabel;

        // Create list node
        listNode = document.createElement("div");

        listHead = document.createElement("div");
        projectLabel = document.createElement("span");
        headChevron = document.createElement("span");
        listLabel = document.createElement("span");
        listContent = document.createElement("div");
        this._refs.lists[listId] = { node: listNode, content: listContent, id: listId, status: list.type };
        this._misc[list.type + "ListsCounter"]++;

        listNode.classList.add("home-list");
        listHead.classList.add("home-list-head");
        projectLabel.classList.add("home-list-head-project", "eon-fg2-hoverable");
        headChevron.classList.add("home-list-head-chevron", "ticon-chevron-right");
        listLabel.classList.add("home-list-head-name");
        listContent.classList.add("home-list-content");

        projectLabel.setAttribute("title", eon.locale.global.tooltip.goToProject);
        projectLabel.innerHTML = board.name;
        listLabel.innerHTML = list.name;

        // Go to the project default view
        projectLabel.addEventListener("click", function (e) {
          var params = {
            board: board.id
          }

          showView("projects", params);
        });

        listHead.appendChild(projectLabel);
        listHead.appendChild(headChevron);
        listHead.appendChild(listLabel);
        listNode.appendChild(listHead);
        listNode.appendChild(listContent);

        return listNode;
      },
      /*
        @function (private) _createTask
        @description
      */
      createTask: function (listObj, id, taskData, options) {
        var el = this;

        var status = options ? options.status : null;
        var color = options ? options.color : null;

        // Check if the task already exists
        if(!this._refs.tasks[id]) {

          el._misc.createTaskFn = el._misc.createTaskFn || function createTask(id, taskData, status, color) {
            var taskNode = document.createElement("home-task");
            taskNode.id = id;
            taskNode.data = taskData;
            taskNode.color = color;
            taskNode.statusColor = el._misc.colors[status];
            taskNode.status = status;

            // Open task listener
            taskNode.addEventListener("click", function (e) {
              task.open(id);
            });

            taskNode.onCreated(function () {
              // Chrono updates
              taskNode.onUpdate(function (taskId, data, cb) {
                task.update(taskId, data, cb);
              });
            });

            taskNode.onReady(function () {
              this.style.opacity = 1;
            });
            el._refs.tasks[id] = { node: taskNode, data: taskData, listId: taskData.listId || listObj.id };
            return taskNode;
          };

          if (!status || !color) {
            var idSplit = id.split(":");
            var boardId = idSplit[0] + ":" + idSplit[1];

            task.getBoardData(boardId, function (board) {
              var list = board.lists.data[taskData.listId];
          
              if(list.type !== "done") {
                if (!listObj) {
                  listNode = el._createList(board, list.id, list);
                  listObj = el._refs.lists[list.id];
                  el._refs[list.type + "List"].appendChild(listNode);
                }

                color = color || board.color;

                el._refs.lists[list.id].content.appendChild(el._misc.createTaskFn(id, taskData, list.type, color));

                // Update counters
                el._misc[list.type + "Counter"]++;
                el._misc.total++;

                eon.triggerCallback("onSocketUpdate", el, el);
              }
            });
          } else {
            if(listObj) {
              var taskNode = el._misc.createTaskFn(id, taskData, status, color);
              listObj.content.appendChild(taskNode);

              // Update counters
              el._misc[status + "Counter"]++;
              el._misc.total++;

              return taskNode;
            }
          }
        } else {
          return this._refs.tasks[id].node;
        }
      },
      /*
        @function (private) _deleteTask
        @description
      */
      deleteTask: function (listObj, id, taskData) {
        // Remove task node and references
        var homeTask = this._refs.tasks[id];
        if(homeTask && listObj) {
          var taskNode = homeTask.node;
          taskNode.parentNode.removeChild(taskNode);
          delete this._refs.tasks[id];
  
          var status = listObj.status;
  
          if (!listObj.content.children.length) {
            listObj.node.parentNode.removeChild(listObj.node);
            delete this._refs.lists[listObj.id];
          }
  
          // Update counters
          this._misc[status + "Counter"]--;
          this._misc.total--;
  
        }
        eon.triggerCallback("onSocketUpdate", this, this);
      },
      /*
        @function (private) _updateTask
        @description
      */
      updateTask: function (id, taskData) {
        var el = this;

        // Update only if session user is assigned to this task
        isTaskViewer(session.data.id, taskData.viewers, function(error, isViewer){
          if(!error) {
            var homeTask = el._refs.tasks[id];

            if(isViewer) {
              // Update or create task
              if(homeTask) {
                homeTask.data = taskData;
                homeTask.node.update(taskData);

                eon.triggerCallback("onSocketUpdate", el, el, ["update"]);
              } else {
                el._createTask(el._refs.lists[taskData.listId], id, taskData);
              }
            } else {
              // Delete task
              if(homeTask) {
                el._deleteTask(el._refs.lists[taskData.listId], id, taskData);
              }
            }
          }
        });
      },
      /*
        @function (private) _moveTask
        @description
      */
      moveTask: function (id, taskData) {
        var el = this;
        var homeTask = this._refs.tasks[id];
   
        if(homeTask) {
          var currentListId = homeTask.listId;
        
          this._deleteTask(this._refs.lists[currentListId], taskData.id, taskData);
          this._createTask(this._refs.lists[taskData.listId], taskData.id, taskData);
        } else {
          // Update only if session user is assigned to this task
          isTaskViewer(session.data.id, taskData.viewers, function(error, isViewer){
            if(!error) {
              if(isViewer) {
                el._createTask(el._refs.lists[taskData.listId], id, taskData);
                eon.triggerCallback("onSocketUpdate", el, el);
              }
            }
          });
        }
      }
    },
    onCreated: function (params) {
      var el = this;

      eon.createCallback("onSlide", el);
      eon.createCallback("onPendingListsReady", el);
      eon.createCallback("onInProgressListsReady", el);
      eon.createCallback("onSocketUpdate", el);

      el.onSlide(function () {
        el._requestRegistration();
      });
    },
    onInit: function () {
      var el = this;

      el._setupHome();

      session.onReady(function () {
        el.refresh();
      });
      session.onWorkspaceChanged(function (data) {
        el.refresh();
      });

      el._refs.thumb.addEventListener('mouseenter', function (e) {
        el._refs.thumb.classList.add("attend-activeThumb");
      }, false);

      el._refs.thumb.addEventListener('mouseleave', function (e) {
        if (!el._misc.isPointerDown) {
          el._refs.thumb.classList.remove("attend-activeThumb");
        }
      }, false);

      el._refs.thumb.addEventListener('pointerdown', function (e) {
        el._handlePointerDown(e);
      }, false);

      el.setAttribute("touch-action", "none");

      el.addEventListener('pointermove', function (e) {
        el._handlePointerMove(e);
      }, false);

      el.addEventListener('pointerup', function (e) {
        el._handlePointerUp(e);
      }, false);

      el._misc.clockinterval = setInterval(function () {

        if (el._misc.workedTimeAutoRefresh) {
          el._refreshWorkedTime(moment(moment().valueOf()).diff(Number(el._misc.currentRegistry.entryUTC)));
        }

      }, 1000);
    },
    onTransformed: function () {
      var el = this;
      // Draw static content
      this._drawStatic();

      el._mainListener();
      el._homeListener();
      el._socketListener();
      el._navigationListener();

      el._setupTypeButtons();
      el._setupForm();
      el._setupOvertimeDialog();

      el._toggleView();
      el._bubbleListener();

      el._addListener();

      if (window.innerWidth <= eon.tabletWidth) {
        el._refs.formSlide.style.opacity = "0";
      }
    }
  });
</script>