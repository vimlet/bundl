<template>

  <div class="workweek-device-hoursHeader">
    <div class="workweek-device-emptyRow"></div>

    <div class="workweek-device-daysWrapper" eon-ref="daysWrapper">
    </div>
  </div>

  <div class="workweek-device-weekWrapper">

    <div class="workweek-device-absoluteContainer">

      <div class="workweek-device-hoursRow" eon-ref="hoursHeader"></div>
      <div class="workweek-device-emptyHeader" eon-ref="emptyHeader"></div>

      <eon-scroll eon-ref="scrollWork" thickness="5" static="true">
        <div class="workweek-device-hoursWrapper" eon-ref="hoursWrapper">
        </div>
      </eon-scroll>

    </div>
  </div>

</template>

<script>
  eon.element({

    name: "workweek-device",
    style: "workweek-device.css",


    dependencies: [
    ],
    properties: {

    },
    privateProperties: {
      /*
        @property (private) {Object} _misc
        @description Object with useful information
      */
      misc: {
        value: {},
        reflect: false
      },
      /*
        @property (private) {Object} _refs
        @description Object with references to frequently queried nodes
      */
      refs: {
        value: {},
        reflect: false
      }
    },
    functions: {

    },
    privateFunctions: {
      /*
        @function (private) _setupDays
        @description 
      */
      setupDays: function () {
        var el = this;
        var dayNode;
        var dayRail;

        el._refs.weekStart = parseInt(el._refs.parent.weekStart);
        if (el._refs.weekStart > 6) {
          el._refs.weekStart = 0;
        }

        for (var i = 0; i < 7; i++) {
          dayNode = document.createElement("eon-variable");
          dayRail = document.createElement("div");

          dayNode.classList.add("workweek-device-day");
          dayRail.classList.add("workweek-device-weekRail", "day" + (i + el._refs.weekStart) % 7);

          dayNode.setAttribute("global", "true");

          dayNode.setAttribute("bind", "locale.workspace.plans." + el._weekdayName((i + el._refs.weekStart) % 7) + "Short");

          el._refs.daysWrapper.appendChild(dayNode);
          el._refs.hoursWrapper.appendChild(dayRail);
        }

        el._setupWeekHours();
      },
      /*
        @function (private) _weekdayName
        @description 
      */
      weekdayName: function (index) {
        var el = this;
        var weekDays = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];

        return weekDays[index];
      },
      /*
       @function (private) _setupHours
       @description 
     */
      setupHours: function () {
        var el = this;
        var hours = 25;
        var hoursEmpty = 24;
        var hourNode;
        var emptyNode;

        for (var i = 0; i < hours; i++) {
          hourNode = document.createElement("div");

          if (i == 0 || i == 24) {
            hourNode.classList.add("workweek-device-hourSpacer");
          } else {
            hourNode.classList.add("workweek-device-hour");
            hourNode.innerHTML = i + ":00";
          }

          el._refs.hoursHeader.appendChild(hourNode);
        }
        for (var i = 0; i < hoursEmpty; i++) {
          emptyNode = document.createElement("div");

          emptyNode.classList.add("workweek-device-emptyHour");
          el._refs.emptyHeader.appendChild(emptyNode);
        }
      },
      /*
        @function (private) _setupWeekHours
        @description 
      */
      setupWeekHours: function () {
        var el = this;
        var hours = 24;
        var weekHourNode;
        var oclockNode;
        var quarterNode;
        var halfNode;
        var quartertoNode;
        var weekRails = el._refs.hoursWrapper.querySelectorAll(".workweek-device-weekRail");
        var i, j;

        for (i = 0; i < weekRails.length; i++) {
          for (j = 0; j < hours; j++) {
            weekHourNode = document.createElement("div");
            oclockNode = document.createElement("div");
            quarterNode = document.createElement("div");
            halfNode = document.createElement("div");
            quartertoNode = document.createElement("div");

            weekHourNode.classList.add("workweek-device-weekHour", "weekHour" + j);
            oclockNode.classList.add("oclock" + j, "oclock");
            quarterNode.classList.add("quarter" + j, "quarter");
            halfNode.classList.add("half" + j, "half");
            quartertoNode.classList.add("quarterto" + j, "quarterto");

            el._setRailsListeners(oclockNode, quarterNode, halfNode, quartertoNode);

            weekHourNode.appendChild(oclockNode);
            weekHourNode.appendChild(quarterNode);
            weekHourNode.appendChild(halfNode);
            weekHourNode.appendChild(quartertoNode);

            weekRails[i].appendChild(weekHourNode);
          }
        }

      },
      /*
      @function (private) _setHoursListeners
      @description 
    */
      // TODO:
      setRailsListeners: function (oclock, quarter, half, quarterto) {
        var el = this;

        // // Down events
        // oclock.addEventListener("pointerdown", function () {
        //   el._misc.startBar = true;
        //   console.log("oclockDOwn");

        // });
        // quarter.addEventListener("pointerdown", function () {
        //   el._misc.startBar = true;
        //   console.log("quarterDown");
        // });
        // half.addEventListener("pointerdown", function () {
        //   el._misc.startBar = true;
        //   console.log("halfDown");
        // });
        // quarterto.addEventListener("pointerdown", function () {
        //   el._misc.startBar = true;
        //   console.log("quartertoDown");
        // });

        // // Over events
        // oclock.addEventListener("pointerover", function () {
        //   if (el._misc.startBar) {
        //     console.log("oclockOver");   
        //   }
        // });
        // quarter.addEventListener("pointerover", function () {
        //   if (el._misc.startBar) {
        //     console.log("quarterOver");
        //   }
        // });
        // half.addEventListener("pointerover", function () {
        //   if (el._misc.startBar) {
        //     console.log("halfOver");
        //   }
        // });
        // quarterto.addEventListener("pointerover", function () {
        //   if (el._misc.startBar) {
        //     console.log("quartertoOver"); 
        //   }
        // });

        // // Up events
        // oclock.addEventListener("pointerup", function () {
        //   el._misc.startBar = false;
        //   console.log("oclockUp");
        // });
        // quarter.addEventListener("pointerup", function () {
        //   el._misc.startBar = false;
        //   console.log("quarterUp");
        // });
        // half.addEventListener("pointerup", function () {
        //   el._misc.startBar = false;
        //   console.log("halfUp");
        // });
        // quarterto.addEventListener("pointerup", function () {
        //   el._misc.startBar = false;
        //   console.log("quartertoUp");
        // });

      },

      /*
        @function (private) _setScrollListener
        @description 
      */
      setScrollListener: function () {
        var el = this;

        el._refs.scrollWork.onScrolled(function () {
          el._refs.daysWrapper.scrollLeft = el._refs.scrollWork.scrollLeft;
          el._refs.hoursHeader.scrollTop = el._refs.scrollWork.scrollTop;
          el._refs.emptyHeader.scrollTop = el._refs.scrollWork.scrollTop;
        });

      },
    },
    onCreated: function () {
      var el = this;

      el._refs.parent = $1("app-workweek");

      el._setupDays();
      el._setupHours();
    },

    onReady: function () {
      var el = this;

      el._setScrollListener();
    },
  });
</script>