{"version":3,"file":"post.js","sourceRoot":"","sources":["../../../../src/lib/middleware/post.ts"],"names":[],"mappings":";;;;;;;;;;;IAKA,SAAwB,IAAI,CAAC,OAAgB;QAC3C,OAAO,UAAC,OAAO,EAAE,QAAQ,EAAE,IAAI;YAC7B,IAAI,OAAO,CAAC,MAAM,KAAK,MAAM,EAAE;gBAC7B,OAAO,IAAI,EAAE,CAAC;aACf;YAEO,IAAA,2BAAQ,EAAE,qCAAa,CAAa;YAE5C,IAAI;gBACF,IAAI,WAAW,GAAQ,OAAO,CAAC,IAAI,CAAC;gBAEpC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE;oBAC/B,WAAW,GAAG,CAAC,WAAW,CAAC,CAAC;iBAC7B;gBAED,IAAM,QAAQ,GAAc,WAAW,CAAC,GAAG,CAAC,UAC1C,aAAqB;oBAErB,OAAO,IAAI,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;gBACnC,CAAC,CAAC,CAAC;gBAEH,QAAQ,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAC;gBAEvC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAA,OAAO,IAAI,OAAA,aAAa,CAAC,OAAO,CAAC,EAAtB,CAAsB,CAAC,CAAC;qBACzD,IAAI,CAAC;oBACJ,QAAQ,CAAC,UAAU,GAAG,GAAG,CAAC;oBAC1B,QAAQ,CAAC,GAAG,EAAE,CAAC;gBACjB,CAAC,CAAC;qBACD,KAAK,CAAC;oBACL,QAAQ,CAAC,UAAU,GAAG,GAAG,CAAC;oBAC1B,QAAQ,CAAC,GAAG,EAAE,CAAC;gBACjB,CAAC,CAAC,CAAC;aACN;YAAC,OAAO,CAAC,EAAE;gBACV,QAAQ,CAAC,UAAU,GAAG,GAAG,CAAC;gBAC1B,QAAQ,CAAC,GAAG,EAAE,CAAC;aAChB;QACH,CAAC,CAAC;IACJ,CAAC;IArCD,uBAqCC","sourcesContent":["import { RequestHandler } from 'express';\n\nimport { Context } from '../Server';\nimport { Message } from '../channels/Base';\n\nexport default function post(context: Context): RequestHandler {\n  return (request, response, next) => {\n    if (request.method !== 'POST') {\n      return next();\n    }\n\n    const { executor, handleMessage } = context;\n\n    try {\n      let rawMessages: any = request.body;\n\n      if (!Array.isArray(rawMessages)) {\n        rawMessages = [rawMessages];\n      }\n\n      const messages: Message[] = rawMessages.map(function(\n        messageString: string\n      ) {\n        return JSON.parse(messageString);\n      });\n\n      executor.log('Received HTTP messages');\n\n      Promise.all(messages.map(message => handleMessage(message)))\n        .then(() => {\n          response.statusCode = 204;\n          response.end();\n        })\n        .catch(() => {\n          response.statusCode = 500;\n          response.end();\n        });\n    } catch (_) {\n      response.statusCode = 500;\n      response.end();\n    }\n  };\n}\n"]}