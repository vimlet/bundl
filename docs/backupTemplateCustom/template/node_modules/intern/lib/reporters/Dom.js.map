{"version":3,"file":"Dom.js","sourceRoot":"","sources":["../../../../src/lib/reporters/Dom.ts"],"names":[],"mappings":"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","sourcesContent":["import { global } from '@theintern/common';\nimport { Executor } from '../executors/Executor';\nimport Reporter, { eventHandler, ReporterProperties } from './Reporter';\nimport Suite from '../Suite';\nimport Test from '../Test';\n\n/**\n * The Dom reporter outputs text into the DOM, essentially treating it like the\n * console.\n */\nexport default class Dom extends Reporter {\n  document: HTMLDocument;\n\n  suiteNode: HTMLElement;\n\n  testNode: HTMLElement | undefined;\n\n  constructor(executor: Executor, options: DomOptions = {}) {\n    super(executor, options);\n    this.document = options.document || document;\n    this.suiteNode = options.suiteNode || this.document.body;\n  }\n\n  @eventHandler()\n  error(error: Error) {\n    const errorNode = this.document.createElement('pre');\n    errorNode.appendChild(\n      this.document.createTextNode(this.formatError(error))\n    );\n    this.document.body.appendChild(errorNode);\n  }\n\n  @eventHandler()\n  suiteEnd(suite: Suite) {\n    this.suiteNode = <HTMLElement>(\n      (this.suiteNode!.parentNode!.parentNode || this.document.body)\n    );\n\n    if (suite.error) {\n      this.suiteNode.appendChild(\n        this.document.createTextNode('Suite \"' + suite.id + '\" failed')\n      );\n      this.suiteNode.style.color = 'red';\n\n      const errorNode = this.document.createElement('pre');\n      errorNode.appendChild(\n        this.document.createTextNode(this.formatError(suite.error))\n      );\n      this.suiteNode.appendChild(errorNode);\n      this._scroll();\n    }\n  }\n\n  @eventHandler()\n  suiteStart(suite: Suite) {\n    const oldSuiteNode = this.suiteNode;\n    this.suiteNode = this.document.createElement('ol');\n\n    if (oldSuiteNode === this.document.body) {\n      oldSuiteNode.appendChild(this.suiteNode);\n    } else {\n      const outerSuiteNode = this.document.createElement('li');\n      const headerNode = this.document.createElement('div');\n\n      headerNode.appendChild(this.document.createTextNode(suite.name!));\n      outerSuiteNode.appendChild(headerNode);\n      outerSuiteNode.appendChild(this.suiteNode);\n      oldSuiteNode.appendChild(outerSuiteNode);\n    }\n\n    this._scroll();\n  }\n\n  @eventHandler()\n  testEnd(test: Test) {\n    if (test.skipped) {\n      const testNode = (this.testNode = this.document.createElement('li'));\n      testNode.appendChild(\n        this.document.createTextNode(\n          test.name +\n            ' skipped' +\n            (test.skipped ? ' (' + test.skipped + ')' : '')\n        )\n      );\n      testNode.style.color = 'gray';\n      this.suiteNode.appendChild(testNode);\n    } else if (test.error) {\n      const testNode = this.testNode!;\n      testNode.appendChild(\n        this.document.createTextNode(' failed (' + test.timeElapsed + 'ms)')\n      );\n      testNode.style.color = 'red';\n\n      const errorNode = this.document.createElement('pre');\n      errorNode.appendChild(\n        this.document.createTextNode(this.formatError(test.error))\n      );\n      testNode.appendChild(errorNode);\n    } else {\n      const testNode = this.testNode!;\n      testNode.appendChild(\n        this.document.createTextNode(' passed (' + test.timeElapsed + 'ms)')\n      );\n      testNode.style.color = 'green';\n    }\n    this._scroll();\n  }\n\n  @eventHandler()\n  testStart(test: Test) {\n    this.testNode = this.document.createElement('li');\n    this.testNode.appendChild(this.document.createTextNode(test.name));\n    this.suiteNode.appendChild(this.testNode);\n    this._scroll();\n  }\n\n  private _scroll() {\n    global.scrollTo(\n      0,\n      this.document.documentElement!.scrollHeight ||\n        this.document.body.scrollHeight\n    );\n  }\n}\n\nexport interface DomProperties extends ReporterProperties {\n  document: Document;\n  suiteNode: HTMLElement;\n}\n\nexport type DomOptions = Partial<DomProperties>;\n"]}