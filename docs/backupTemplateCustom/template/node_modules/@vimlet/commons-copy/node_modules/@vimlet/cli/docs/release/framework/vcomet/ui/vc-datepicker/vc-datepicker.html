<template>

  <div class="vc-datepicker-calendar vc-unselectable">
    <div class="vc-datepicker-wrapper vc-bg2-boxshadow">

      <div class="vc-datepicker-header vc-bg1 vc-fg2">
        <div class="vc-datepicker-leftNavigation">
          <div class="vc-datepicker-previous vc-unselectable">
            <i class="material-icons">chevron_left</i>
          </div>
          <div class="vc-datepicker-next vc-unselectable">
            <i class="material-icons">chevron_right</i>
          </div>
        </div>

        <div class="vc-datepicker-daysGridSelectors">
          <div class="vc-datepicker-month"></div>
          <div class="vc-datepicker-year"></div>
        </div>

        <div class="vc-datepicker-rightNavigation">
          <div class="vc-datepicker-back vc-unselectable hidden">
            <i class="material-icons">keyboard_return</i>
          </div>
          <div class="vc-datepicker-close vc-unselectable">
            <i class="material-icons">clear</i>
          </div>
        </div>
      </div>

      <div class="vc-datepicker-body vc-bg3 vc-fg3"> </div>

    </div>
  </div>

</template>

<script>
  vcomet.element("vc-datepicker", "vc-datepicker.css", {
    themed: true,
    properties: {
      /*
      @property {string} name
      @description Name to identify the element in a form
      */
      name: {
        value: "",
        reflect: true
      },
      /*
      @property {string} value
      @description Value of the element
      */
      value: {
        value: "",
        reflect: false
      },
      /*
      @property {string} locale
      @description If not provided we will use the navigator language
      */
      locale: {
        value: "",
        reflect: true
      },
      /*
      @property {string} min
      @description Indicates the inferior limit of the date
      */
      min: {
        value: "",
        reflect: true
      },
      /*
      @property {string} max
      @description Indicates the superior limit of the date
      */
      max: {
        value: "",
        reflect: true
      },
      /*
      @property {string} closable
      @description Whether the datepicker has the close button
      */
      closable: {
        value: "false",
        reflect: true
      },
      /*
      @property {string} fontsize
      @description Basic fontSize from where we will determine all the sizes
      */
      fontsize: {
        value: 15,
        reflect: true
      },
      /*
      @property {string} weekStart
      @description Indicates the first day of the week for the datepicker
      */
      weekStart: {
        value: "monday",
        reflect: true
      },
      /*
      @property {string} weekDaysFormat
      @description Indicates the format of the weekdays header
      */
      weekDaysFormat: {
        value: "short",
        reflect: true
      },
      /*
      @property {string} valueFormat
      @description Indicates the format of the value
      */
      valueFormat: {
        value: "YYYY-MM-DD",
        reflect: true
      },
      /*
      @property {string} pickerselectable
      @description Indicates the selectable values of the datepicker (day, month and year)
      */
      selectable: {
        value: "dmy",
        reflect: true
      },
      /*
      @property {string} month
      @description Only used for setting up pickers with selectable = "d"
      */
      month: {
        value: "",
        reflect: true
      },
      /*
      @property {string} year
      @description Only used for setting up pickers with selectable = "m"/"d"
      */
      year: {
        value: "",
        reflect: true
      }
    },

    privateProperties: {
      /*
      @property (private) {object} _daysGrid
      @description Reference to the daysGrid node
      */
      daysGrid: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {object} _monthsGrid
      @description Reference to the monthsGrid node
      */
      monthsGrid: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {object} _yearsGrid
      @description Reference to the yearsGrid node
      */
      yearsGrid: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {array} _weekDays
      @description Stores all the data for the weekDays
      */
      weekDays: {
        value: [],
        reflect: false
      },
      /*
      @property (private) {object} _selectorsContainer
      @description Reference to the header selectors container
      */
      selectorsContainer: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {array} _monthSelector
      @description Reference to the monthSelector
      */
      monthSelector: {
        value: [],
        reflect: false
      },
      /*
      @property (private) {array} _yearSelector
      @description Reference to the yearSelector
      */
      yearSelector: {
        value: [],
        reflect: false
      },
      /*
      @property (private) {object} _misc
      @description Object with usefull information
      */
      misc: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {object} _refs
      @description Object with usefull information
      */
      refs: {
        value: {},
        reflect: false
      },
      /*
      @property (private) {string} _formelement 
      @description Necessary property for a form
      */
      formelement: {
        value: "date"
      },
    },

    privateFunctions: {
      /*
      @function (private) _setup
      @description Here we setup everything we need for the element
      */
      setup: function () {

        var el = this;

        el.locale = (el.locale != undefined && el.locale != "") ? el.locale : navigator.language;
        el.setAttribute("valid", "false");

        el._setupMisc();
        el._setupWeekDays();

        if (el.selectable.indexOf('y') > -1) {
          el._setupYearsGrid();
        }

        if (el.selectable.indexOf('m') > -1) {
          el._setupMonthsGrid();
        }

        if (el.selectable.indexOf('d') > -1) {
          el._setupDaysGrid();
        }

        el._setupRefs();

        //If the user specified a min date
        if (el.min != "" && el.min != undefined) {
          el._setupMinDate();
        }

        //If the user specified a max date
        if (el.max != "" && el.max != undefined) {
          el._setupMaxDate();
        }

        el._setupEvents();
        el._setupInitialDate();

        el._setupClosable();

        el._handleInitialState();
        el._handleAutoHeight();
        el._handleFonts();

        if (vcomet.util.isTouchScreen()) {
          el.dataset.touch = "true";
        }

        vcomet.addResizeListener(el.querySelector(".vc-datepicker-calendar"), el.nodeName.toLowerCase(), function () {
          el._handleAutoHeight();
          el._handleFonts();
        });

      },
      /*
      @function (private) _setupMisc
      @description Sets up basic properties for the data object
      */
      setupMisc: function () {

        var el = this;

        el._misc.focus = [];
        el._misc.current = {};
        el._misc.selected = {};
        el._misc.selector = {};
        el._misc.selector.type = "month";
        el._misc.selector.range = {};
        el._misc.mask = {};
        el._misc.min = {};
        el._misc.min.active = false;
        el._misc.max = {};
        el._misc.max.active = false;

        el._misc.downTrigger = vcomet.util.isTouchScreen() ? "touchstart" : "mousedown";

      },
      /*
      @function (private) _setupRefs
      @description Creates some fast access elements so that theres no need for calling the QuerySelector all the time.
      */
      setupRefs: function () {

        var el = this;

        el._refs.selectorsContainer = el.querySelector(".vc-datepicker-daysGridSelectors");
        el._refs.monthSelector = el.querySelector(".vc-datepicker-header .vc-datepicker-month");
        el._refs.yearSelector = el.querySelector(".vc-datepicker-header .vc-datepicker-year");

        el._refs.daysGrid = el.querySelector(".vc-datepicker-daysGrid");
        el._refs.monthsGrid = el.querySelector(".vc-datepicker-monthsGrid");
        el._refs.yearsGrid = el.querySelector(".vc-datepicker-yearsGrid");
      },
      /*
      @function (private) _handleInitialState
      @description andles the grid to be showed when opening the picker for the first time
      */
      handleInitialState: function () {

        var el = this;

        switch (el.selectable) {
          case "dmy":
            el._fillDaysGrid(el._misc.current.year, el._misc.current.month);
            el._showDaysGrid();
            break;
          case "my":
            el._showMonthsGrid();
            break;
          case "d":
            var previousMonth;
            var minDate;
            var maxDate;

            el._misc.current.year = (el.year != "") ? el.year : el._misc.current.year;
            el._misc.current.month = (el.month != "") ? el.month : el._misc.current.month;

            minDate = 1 + "/" + (parseInt(el._misc.current.month) + 1) + "/" + el._misc.current.year;
            maxDate = vcomet.time.getDaysInMonth(el._misc.current.year, el._misc.current.month) + "/" + (parseInt(el._misc.current.month) + 1) + "/" + el._misc.current.year;

            el.min = minDate;
            el.max = maxDate;

            el._setupMinDate();
            el._setupMaxDate();

            el._fillDaysGrid(el._misc.current.year, el._misc.current.month);
            el._showDaysGrid();
            el._disableSelectors();

            if (el.year != "" && el.month != "") {
              el._disableNavigation();
            }
            break;
          case "m":
            el._misc.current.year = (el.year != "") ? el.year : el._misc.current.year;

            el._showMonthsGrid();
            el._disableSelectors();
            if (el.year != "") {
              el._disableNavigation();
            }
            break;
          case "y":
            el._showYearsGrid();
            break;
          default:
            console.warn("Invalid selectable");
        }
      },
      /*
      @function (private) _setupWeekDays
      @description Sets up the weekdays, including its locale, format and weekDayStart
      */
      setupWeekDays: function () {

        var el = this;

        function reorderWeekDays(array, oldIndex, newIndex) {
          while (oldIndex < 0) {
            oldIndex += array.length;
          }
          while (newIndex < 0) {
            newIndex += array.length;
          }
          if (newIndex >= array.length) {
            var k = newIndex - array.length;
            while ((k--) + 1) {
              array.push(undefined);
            }
          }
          array.splice(newIndex, 0, array.splice(oldIndex, 1)[0]);
          return array;
        }

        el._weekDays.display = vcomet.time.getWeekDays(el.locale, el.weekDaysFormat);
        el._weekDays.keys = vcomet.time.getWeekDays("en", "long");

        if (el._weekDays.keys[0].toLowerCase() != el.weekStart.toLowerCase()) {

          for (var i = 0; i < el._weekDays.keys.length; i++) {

            el._weekDays.display = reorderWeekDays(el._weekDays.display, 6, 0);
            el._weekDays.keys = reorderWeekDays(el._weekDays.keys, 6, 0);

            if (el._weekDays.keys[0].toLowerCase() == el.weekStart.toLowerCase()) {
              break;
            }
          }
        }
      },
      /*
      @function (private) _setupMinDate
      @description Sets up the inferior limit of the date
      */
      setupMinDate: function () {

        var el = this;

        // if (el.min.includes("/")) {
        if (el.min.indexOf('/') > -1) {

          var splittedMin = el.min.split("/");

          el._misc.min.day = parseInt(splittedMin[0]);
          el._misc.min.month = parseInt(splittedMin[1]) - 1;
          el._misc.min.year = parseInt(splittedMin[2]);

        } else {

          var date = new Date(parseInt(el.min));

          el._misc.min.day = date.toLocaleString([], {
            day: "numeric"
          });

          el._misc.min.month = date.toLocaleString([], {
            month: "numeric"
          });

          el._misc.min.year = date.toLocaleString([], {
            year: "numeric"
          });
        }

        el._misc.min.active = true;
      },
      /*
      @function (private) _setupMinDate
      @description Sets up the superior limit of the date
      */
      setupMaxDate: function () {

        var el = this;

        if (el.max.indexOf('/') > -1) {

          var splittedMax = el.max.split("/");

          el._misc.max.day = parseInt(splittedMax[0]);
          el._misc.max.month = parseInt(splittedMax[1]) - 1;
          el._misc.max.year = parseInt(splittedMax[2]);

        } else {

          var date = new Date(parseInt(el.max));

          el._misc.max.day = date.toLocaleString([], {
            day: "numeric"
          });

          el._misc.max.month = date.toLocaleString([], {
            month: "numeric"
          });

          el._misc.max.year = date.toLocaleString([], {
            year: "numeric"
          });
        }

        el._misc.max.active = true;
      },
      /*
      @function (private) _setupEvents
      @description Sets up the basic events of the header buttons
      */
      setupEvents: function () {

        var el = this;

        el.querySelector(".vc-datepicker-previous").addEventListener(el._misc.downTrigger, function (e) {
          e.stopPropagation();
          e.preventDefault();
          el._goToPrevious(this);
        });

        el.querySelector(".vc-datepicker-next").addEventListener(el._misc.downTrigger, function (e) {
          e.stopPropagation();
          e.preventDefault();
          el._goToNext(this);
        });

        el.querySelector(".vc-datepicker-back").addEventListener(el._misc.downTrigger, function (e) {
          e.stopPropagation();
          e.preventDefault();
          el._goBack(this);
        });

        el.querySelector(".vc-datepicker-close").addEventListener(el._misc.downTrigger, function (e) {
          e.stopPropagation();
          e.preventDefault();
          el._hide();
        });

        el.querySelector(".vc-datepicker-header .vc-datepicker-month").addEventListener(el._misc.downTrigger, function (e) {
          if (this.dataset.disabled != "true") {
            e.stopPropagation();
            e.preventDefault();
            el._showMonthsGrid();
          }
        });

        el.querySelector(".vc-datepicker-header .vc-datepicker-year").addEventListener(el._misc.downTrigger, function (e) {
          if (this.dataset.disabled != "true") {
            e.stopPropagation();
            e.preventDefault();
            el._showYearsGrid();
          }
        });
      },
      /*
      @function (private) _setupInitialDate
      @description Sets up the first date to be showed on the calendar depending on min, max dates
      */
      setupInitialDate: function () {

        var el = this;
        var date = new Date();

        var day = date.getDay();
        var month = date.getMonth();
        var year = date.getFullYear();


        if ((month <= el._misc.min.month && year <= el._misc.min.year || year <= el._misc.min.year)) {

          el._misc.current.month = parseInt(el._misc.min.month);
          el._misc.current.year = el._misc.min.year;

        } else if ((month >= el._misc.max.month && year >= el._misc.max.year) || year >= el._misc.max.year) {

          el._misc.current.month = parseInt(el._misc.max.month);
          el._misc.current.year = el._misc.max.year;

        } else {

          el._misc.current.month = month;
          el._misc.current.year = year;
        }


      },
      /*
      @function (private) _setupDaysGrid
      @description Sets up the days Grid
      */
      setupDaysGrid: function () {

        var el = this;

        var week;
        var day;

        var daysGridContainer = document.createElement("div");
        var weekDaysContainer = document.createElement("div");
        var daysGrid = document.createElement("div");

        var weeksFragment = document.createDocumentFragment();

        daysGridContainer.style.zIndex = -1;

        daysGridContainer.classList.add("vc-datepicker-daysGrid");
        weekDaysContainer.classList.add("vc-datepicker-weekDays");
        daysGrid.classList.add("vc-datepicker-grid");

        daysGridContainer.appendChild(weekDaysContainer);
        daysGridContainer.appendChild(daysGrid);
        el.querySelector(".vc-datepicker-body").appendChild(daysGridContainer);

        el._createWeekDaysHeaders();

        for (var i = 1; i <= 6; i++) {

          week = document.createElement("div");
          week.classList.add("vc-datepicker-week");

          for (var j = 1; j <= 7; j++) {

            day = document.createElement("div");
            day.classList.add("vc-datepicker-day");
            day.addEventListener(el._misc.downTrigger, function (e) {
              el._selectDay(this);
            });

            week.appendChild(day);
          }
          weeksFragment.appendChild(week);
        }
        daysGrid.appendChild(weeksFragment);
      },
      /*
      @function (private) _setupMonthsGrid
      @description Sets up the months Grid
      */
      setupMonthsGrid: function () {

        var el = this;

        var row;
        var month;

        var monthsGrid = document.createElement("div");
        var rowsFragment = document.createDocumentFragment();

        var months = vcomet.time.getMonthNames(el.locale, "short");

        monthsGrid.classList.add("vc-datepicker-monthsGrid");
        monthsGrid.classList.add("vc-bg3");
        el.querySelector(".vc-datepicker-body").appendChild(monthsGrid);

        row = document.createElement("div");
        row.classList.add("vc-datepicker-row");

        for (var i = 0; i < months.length; i++) {

          month = document.createElement("div");
          month.classList.add("month");
          month.innerHTML = months[i];
          month.dataset.index = i;

          month.addEventListener(el._misc.downTrigger, function (e) {
            el._selectMonth(this);
          });

          row.appendChild(month);

          if (row.childNodes.length == 4) {
            rowsFragment.appendChild(row);
            row = document.createElement("div");
            row.classList.add("vc-datepicker-row");
          }
        }

        monthsGrid.appendChild(rowsFragment);
      },
      /*
      @function (private) _setupYearsGrid
      @description Sets up the years Grid
      */
      setupYearsGrid: function () {

        var el = this;

        var row;
        var year;

        var yearsGrid = document.createElement("div");
        var rowsFragment = document.createDocumentFragment();

        var years = [];

        for (var i = 2017 - 6; i < 2017 + 6; i++) {
          years.push(i);
        }

        yearsGrid.classList.add("vc-datepicker-yearsGrid");
        yearsGrid.classList.add("vc-bg3");
        el.querySelector(".vc-datepicker-body").appendChild(yearsGrid);

        row = document.createElement("div");
        row.classList.add("vc-datepicker-row");

        for (var i = 0; i < years.length; i++) {

          year = document.createElement("div");
          year.classList.add("vc-datepicker-year");

          year.addEventListener(el._misc.downTrigger, function (e) {
            el._selectYear(this);
          });

          row.appendChild(year);

          if (row.childNodes.length == 4) {
            rowsFragment.appendChild(row);
            row = document.createElement("div");
            row.classList.add("vc-datepicker-row");
          }
        }

        yearsGrid.appendChild(rowsFragment);
      },
      /*
      @function (private) _setupClosable
      @description If the calendar is not closable we hide the button
      */
      setupClosable: function () {

        if (this.closable != "true") {
          this.querySelector(".vc-datepicker-close").classList.add("hidden");
        }
      },
      /*
      @function (private) _handleAutoHeight
      @description Maintains an aspect ratio for the picker relative to its width
      */
      handleAutoHeight: function () {

        var el = this;
        var calendar = el.querySelector(".vc-datepicker-calendar");

        if (calendar.offsetWidth != 0) {
          calendar.style.height = (parseFloat(calendar.offsetWidth) * 0.839) + "px";
        }

      },
      /*
      @function (private) _createWeekDaysHeaders
      @description Creates the weekdays headers for the daysGrid
      */
      createWeekDaysHeaders: function () {

        var el = this;

        var dayHeadersFragment = document.createDocumentFragment();
        var dayHeader;

        for (var i = 0; i < el._weekDays.keys.length; i++) {

          dayHeader = document.createElement("div");
          dayHeader.classList.add("vc-datepicker-dayHeader");
          dayHeader.innerHTML = el._weekDays.display[i];

          dayHeadersFragment.appendChild(dayHeader);
        }

        el.querySelector(".vc-datepicker-daysGrid .vc-datepicker-weekDays").appendChild(dayHeadersFragment);
      },
      /*
      @function (private) _fillDaysGrid
      @description Fills the grid with the corresponding days for the provided year/month
      @param {Number} year
      @param {Number} month
      */
      fillDaysGrid: function (year, month) {

        var el = this;

        var gridWeeks = el.querySelector(".vc-datepicker-grid").children;

        var monthDays = vcomet.time.getDaysInMonth(year, month);
        var monthFirstWeekDay = vcomet.time.firstWeekDay("en", year, month, "long");

        var previous = el._getPreviousByMonth(year, month);
        var next = el._getNextByMonth(year, month);

        var previousMonthDaysToDisplay = el._getPreviousMonthDaysToDisplay(year, month);
        var nextMonthDaysToDisplay = el._getNextMonthDaysToDisplay(year, month, monthDays, previousMonthDaysToDisplay);

        var week = gridWeeks[0];

        var currentWeek = 0;
        var weekDaysCount = 0;
        var dummyDay, day;

        var areLimits = (el._misc.min.active == true || el._misc.max.active == true);

        if (areLimits) {
          var isPreviousMonthMin = el._isMinMonth(previous.year, previous.month);
          var isMinMonth = el._isMinMonth(year, month);
          var isNextMonthMin = el._isMinMonth(next.year, next.month);

          var isPreviousMonthMax = el._isMaxMonth(previous.year, previous.month);
          var isMaxMonth = el._isMaxMonth(year, month);
          var isNextMonthMax = el._isMaxMonth(next.year, next.month);

          var disableDayAsMin, disableDayAsMax;
        }

        el._misc.current.year = year;
        el._misc.current.month = month;

        //Create previous Month Days
        for (var i = 0; i < previousMonthDaysToDisplay.length; i++) {
          if (el._weekDays.keys[i] == monthFirstWeekDay) {
            break;
          } else {

            day = week.children[weekDaysCount];

            if (day) {

              day.innerHTML = previousMonthDaysToDisplay[i];
              day.classList.add("vc-datepicker-previousMonth");
              day.classList.add("vc-fg4");
              day.classList.remove("vc-datepicker-current");
              day.classList.remove("vc-fg1-active");

              day.setAttribute("year", previous.year);
              day.setAttribute("month", previous.month);
              day.setAttribute("day", previousMonthDaysToDisplay[i]);

              if (areLimits) {

                disableDayAsMin = (isPreviousMonthMin && previousMonthDaysToDisplay[i] < el._misc.min.day || isMinMonth || isNextMonthMin) ? true : false;
                disableDayAsMax = (isPreviousMonthMax && previousMonthDaysToDisplay[i] > el._misc.max.day) ? true : false;

                day.dataset.disabled = ((disableDayAsMin && disableDayAsMax) || (disableDayAsMin || disableDayAsMax)) ? "true" : "false";
              }

            }

            weekDaysCount++;
          }
        }

        //Create actual month days
        for (var i = 1; i <= monthDays; i++) {

          day = week.children[weekDaysCount];

          if (day) {
            day.classList.remove("vc-datepicker-previousMonth");
            day.classList.remove("vc-fg4");
            day.classList.remove("vc-datepicker-nextMonth");
            day.classList.remove("vc-fg4");
            day.classList.remove("vc-datepicker-current");
            day.classList.remove("vc-fg1-active");
            day.innerHTML = i;

            day.setAttribute("year", year);
            day.setAttribute("month", month);
            day.setAttribute("day", i);

            weekDaysCount++;

            if (weekDaysCount == 7) {

              week = gridWeeks[currentWeek + 1];
              weekDaysCount = 0;

              currentWeek++;
            }

            if (areLimits) {

              disableDayAsMin = (isMinMonth && i < el._misc.min.day || isNextMonthMin) ? true : false;
              disableDayAsMax = (isPreviousMonthMax || isMaxMonth && i > el._misc.max.day) ? true : false;

              day.dataset.disabled = ((disableDayAsMin && disableDayAsMax) || (disableDayAsMin || disableDayAsMax)) ? "true" : "false";
            }

          }
        }

        //Create next month days
        for (var i = 0; i < nextMonthDaysToDisplay.length; i++) {

          day = week.children[weekDaysCount];

          if (day) {

            day.innerHTML = nextMonthDaysToDisplay[i];
            day.classList.add("vc-datepicker-nextMonth");
            day.classList.add("vc-fg4");
            day.classList.remove("vc-datepicker-current");
            day.classList.remove("vc-fg1-active");

            day.setAttribute("year", next.year);
            day.setAttribute("month", next.month);
            day.setAttribute("day", nextMonthDaysToDisplay[i]);

            weekDaysCount++;

            if (weekDaysCount == 7) {

              week = gridWeeks[currentWeek + 1];
              weekDaysCount = 0;

              currentWeek++;
            }

            if (areLimits) {

              disableDayAsMin = (isNextMonthMin && nextMonthDaysToDisplay[i] < el._misc.min.day) ? true : false;
              disableDayAsMax = (isNextMonthMax && nextMonthDaysToDisplay[i] > el._misc.max.day || isMaxMonth || isPreviousMonthMax) ? true : false;

              day.dataset.disabled = ((disableDayAsMin && disableDayAsMax) || (disableDayAsMin || disableDayAsMax)) ? "true" : "false";
            }

          }
        }

        var currentDay = el._refs.daysGrid.querySelector('[day="' + el._misc.selected.day + '"][month="' + el._misc.selected.month + '"][year="' + el._misc.selected.year + '"]');

        if (currentDay) {
          el._highlightDay(currentDay);
        }
      },
      /*
      @function (private) _handleMonthsGrid
      @description When the monthsGrid is about the be showed, we handle the ones that the user can click on, and also point out the current month if needed
      */
      handleMonthsGrid: function () {

        var el = this;
        var monthsGrid = el.querySelector(".vc-datepicker-monthsGrid");
        var months = monthsGrid.querySelectorAll('[data-index]');
        var month, disableMonthAsMin, disableMonthAsMax;

        for (var i = 0; i < 12; i++) {

          year = el._misc.current.year;
          month = months[i].dataset.index;

          months[i].dataset.year = year;
          months[i].classList.remove("vc-datepicker-current");
          months[i].classList.remove("vc-fg1-active");

          if (el._misc.current.year == el._misc.min.year || el._misc.current.year == el._misc.max.year) {

            disableMonthAsMin = (year == el._misc.min.year && month < el._misc.min.month || year < el._misc.min.year) ? true : false;
            disableMonthAsMax = (year == el._misc.max.year && month > el._misc.max.month || year > el._misc.max.year) ? true : false;

            months[i].dataset.disabled = ((disableMonthAsMin || disableMonthAsMax) || (disableMonthAsMin && disableMonthAsMax)) ? "true" : "false";

          } else {

            months[i].dataset.disabled = "false";
          }
        }

        el._misc.selected.month = (el._misc.selected.month == undefined) ? el._misc.current.month : el._misc.selected.month;
        el._misc.selected.year = (el._misc.selected.year == undefined) ? el._misc.current.year : el._misc.selected.year;

        var currentMonthCell = monthsGrid.querySelector('[data-index ="' + el._misc.selected.month + '"][data-year ="' + el._misc.selected.year + '"]');

        if (currentMonthCell) {
          el._highlightMonth(currentMonthCell);
        }
      },
      /*
      @function (private) _fillYearsGrid
      @description Fills the grid with the year corresponding to the years range
      */
      fillYearsGrid: function () {

        var el = this;
        var yearsGrid = el.querySelector(".vc-datepicker-yearsGrid");
        var yearsGridRow = yearsGrid.children;
        var year = el._misc.selector.range.start;
        var row;
        var selectedYearCell;

        for (var i = 0; i < yearsGridRow.length; i++) {

          row = yearsGridRow[i];

          for (var j = 0; j < 4; j++) {
            row.children[j].innerHTML = year;
            row.children[j].dataset.year = year;
            row.children[j].classList.remove("vc-datepicker-current");
            row.children[j].classList.remove("vc-fg1-active");

            disableYearAsMin = (parseInt(year) < el._misc.min.year) ? true : false;
            disableYearAsMax = (parseInt(year) > el._misc.max.year) ? true : false;
            row.children[j].dataset.disabled = ((disableYearAsMin || disableYearAsMax) || (disableYearAsMin && disableYearAsMax)) ? "true" : "false";

            year++;
          }
        }

        el._misc.selected.year = (el._misc.selected.year == undefined) ? el._misc.current.year : el._misc.selected.year;

        selectedYearCell = yearsGrid.querySelector('[data-year ="' + el._misc.selected.year + '"]')

        if (selectedYearCell) {
          el._highlightYear(selectedYearCell);
        }
      },
      /*
      @function (private) {Array} _getPreviousMonthDaysToDisplay
      @description Gets the previos month days to show along the current month
      @param {Number} year
      @param {Number} month
      */
      getPreviousMonthDaysToDisplay: function (year, month) {

        var el = this;

        var monthFirstWeekDay = vcomet.time.firstWeekDay("en", year, month, "long");

        var previous = el._getPreviousByMonth(year, month);
        var previousMonthDaysToDisplay = [];
        var previousMonthDays;

        var daysUntilMonthStart = 0;

        previousMonthDays = vcomet.time.getDaysInMonth(previous.year, previous.month)

        for (var i = 0; i < el._weekDays.keys.length; i++) {
          if (monthFirstWeekDay != el._weekDays.keys[i]) {
            previousMonthDaysToDisplay.push(previousMonthDays - i)
          } else {
            break;
          }
        }

        return previousMonthDaysToDisplay.reverse();
      },
      /*
      @function (private) {Array} _getNextMonthDaysToDisplay
      @description Gets the next month days to show along the current month
      @param {Number} year
      @param {Number} month
      @param {Number} monthDays
      @param {Array} previousMonthDaysToDisplay
      */
      getNextMonthDaysToDisplay: function (year, month, monthDays, previousMonthDaysToDisplay) {

        var el = this;

        var nextMonthDaysToDisplay = [];
        var remainingDaysToFill = 42 - monthDays - previousMonthDaysToDisplay.length;

        //Theres no need to know which is the current month as they all start the same
        for (var i = 1; i <= remainingDaysToFill; i++) {
          nextMonthDaysToDisplay.push(i);
        }

        return nextMonthDaysToDisplay;
      },
      /*
      @function (private) _selectDay
      @description Selects the day clicked and runs its default behavior if the user didnt specify a custom callback
      @param {Object} dayButton
      */
      selectDay: function (dayButton) {

        if (dayButton.dataset.disabled != "true") {

          var el = this;
          // We have to add 1 to the month becouse the indexes are set starting from 0 to match it with the way js Date works
          var dateObj = {
            day: dayButton.getAttribute("day"),
            month: (parseInt(dayButton.getAttribute("month")) + 1),
            year: dayButton.getAttribute("year")
          };

          el._misc.selected.day = parseInt(dayButton.getAttribute("day"));
          el._misc.selected.month = parseInt(dayButton.getAttribute("month"));
          el._misc.selected.year = parseInt(dayButton.getAttribute("year"));

          el._highlightDay(dayButton);

          if (el.__onSelected.length > 0) {

            vcomet.triggerCallback("onSelected", el, el, [dateObj]);

          } else {

            var formattedValue = el._getFormattedValue(dateObj, el.valueFormat);

            el.setAttribute("value", formattedValue);
            el.value = formattedValue;
            el.setAttribute("valid", "true");

          }

        }
      },
      /*
      @function (private) _selectMonth
      @description Selects the month clicked and runs its default behavior if the user didnt specify a specific funcion
      @param {Object} monthButton
      */
      selectMonth: function (monthButton) {

        var el = this;

        if (monthButton.dataset.disabled != "true") {

          el._misc.current.month = parseInt(monthButton.dataset.index);
          el._misc.selected.month = parseInt(monthButton.dataset.index);
          el._misc.selected.year = parseInt(el._misc.current.year);

          if (el._refs.daysGrid) {

            el._fillDaysGrid(el._misc.current.year, el._misc.current.month);
            el._showDaysGrid();

          } else {

            // We have to add 1 to the month becouse the indexes are set starting from 0 to match it with the way js Date works
            var dateObj = {
              day: undefined,
              month: (parseInt(monthButton.dataset.index) + 1),
              year: el._misc.current.year
            };

            el._highlightMonth(monthButton);

            if (el.__onSelected.length > 0) {

              vcomet.triggerCallback("onSelected", el, el, [dateObj]);

            } else {

              var formattedValue = el._getFormattedValue(dateObj, el.valueFormat);

              el.setAttribute("value", formattedValue);
              el.value = formattedValue;
              el.setAttribute("valid", "true");
            }
          }
        }
      },
      /*
      @function (private) _selectYear
      @description Selects the year clicked and runs its default behavior if the user didnt specify a specific funcion
      @param {Object} yearButton
      */
      selectYear: function (yearButton) {

        var el = this;

        if (yearButton.dataset.disabled != "true") {

          el._misc.current.year = parseInt(yearButton.dataset.year);
          el._misc.selected.year = parseInt(yearButton.dataset.year);

          if (el._refs.daysGrid) {

            if (el._isMinMonth(el._misc.current.year, el._misc.current.month)) {
              el._misc.current.month = el._misc.min.month;
              el._misc.selected.month = el._misc.min.month;
            }

            el._fillDaysGrid(el._misc.current.year, el._misc.current.month);
            el._showDaysGrid();

          } else if (el.querySelector(".vc-datepicker-monthsGrid")) {

            if (el._isMinMonth(el._misc.current.year, el._misc.current.month)) {
              el._misc.current.month = el._misc.min.month;
              el._misc.selected.month = el._misc.min.month;
            }

            el._showMonthsGrid();

          } else {

            var dateObj = {
              day: undefined,
              month: undefined,
              year: yearButton.dataset.year
            };

            el._highlightYear(yearButton);

            if (el.__onSelected.length > 0) {

              vcomet.triggerCallback("onSelected", el, el, [dateObj]);

            } else {

              var formattedValue = el._getFormattedValue(dateObj, el.valueFormat);

              el.setAttribute("value", formattedValue);
              el.value = formattedValue;
              el.setAttribute("valid", "true");
            }
          }
        }
      },
      /*
      @function (private) {String} _getFormattedValue
      @description We replace the format with the given data, in case the field's length is lower than its format then we add 0 as needed
      @param {Object} obj
      @param {String} format
      */
      getFormattedValue: function (obj, format) {

        var dayFormat = (format.match(/[d|D]{1,2}/)) ? format.match(/[d|D]{1,2}/)[0] : undefined;
        var monthFormat = (format.match(/[M]{1,4}/)) ? format.match(/[M]{1,4}/)[0] : undefined;
        var yearFormat = (format.match(/[y|Y]{2,4}/)) ? format.match(/[y|Y]{2,4}/)[0] : undefined;

        if (obj.day && dayFormat) {

          var day = obj.day;

          if (obj.day.length < dayFormat.length) {
            for (var i = 0; i < (dayFormat.length - obj.day.length); i++) {
              day = "0" + day;
            }
          }

          format = format.replace(dayFormat, day);
        }

        if (obj.month && monthFormat) {

          var month = obj.month;

          if (obj.month.toString().length < monthFormat.length) {
            for (var i = 0; i < (monthFormat.length - obj.month.toString().length); i++) {
              month = "0" + month;
            }
          }

          format = format.replace(monthFormat, month);
        }

        if (obj.year && yearFormat) {

          var year = obj.year;

          if (obj.year.length < yearFormat.length) {
            for (var i = 0; i < (yearFormat.length - obj.year.length); i++) {
              year = "0" + year;
            }
          }

          format = format.replace(yearFormat, year);
        }

        return format;
      },

      /*
      @function (private) _highlightDay
      @description Highlights the button and removes highlight in the previous one
      @param {Object} dayButton
      */
      highlightDay: function (dayButton) {

        var el = this;
        var previousCurrent = el.querySelector(".vc-datepicker-daysGrid .vc-datepicker-grid .vc-datepicker-current");

        if (previousCurrent) {
          previousCurrent.classList.remove("vc-datepicker-current");
          previousCurrent.classList.remove("vc-fg1-active");
        }

        dayButton.classList.add("vc-datepicker-current");
        dayButton.classList.add("vc-fg1-active");
      },
      /*
      @function (private) _highlightMonth
      @description Highlights the button and removes highlight in the previous one
      @param {Object} monthButton
      */
      highlightMonth: function (monthButton) {

        var el = this;
        var previousCurrent = el.querySelector(".vc-datepicker-monthsGrid .vc-datepicker-current");

        if (previousCurrent) {
          previousCurrent.classList.remove("vc-datepicker-current");
          previousCurrent.classList.remove("vc-fg1-active");
        }

        monthButton.classList.add("vc-datepicker-current");
        monthButton.classList.add("vc-fg1-active");
      },
      /*
      @function (private) _highlightYear
      @description Highlights the button and removes highlight in the previous one
      @param {Object} yearButton
      */
      highlightYear: function (yearButton) {

        var el = this;
        var previousCurrent = el.querySelector(".vc-datepicker-yearsGrid .vc-datepicker-current");

        if (previousCurrent) {
          previousCurrent.classList.remove("vc-datepicker-current");
          previousCurrent.classList.remove("vc-fg1-active");
        }

        yearButton.classList.add("vc-datepicker-current");
        yearButton.classList.add("vc-fg1-active");
      },
      /*
      @function (private) {Object} _getPreviousByMonth
      @description Gets the previos month, the year is returned aswell in case the current month is January
      @param {Number} year
      @param {Number} month
      */
      getPreviousByMonth: function (year, month) {

        if (parseInt(month) - 1 < 0) {
          month = 11
          year = parseInt(year) - 1;
        } else {
          month = parseInt(month) - 1;
        }

        return {
          "month": month,
          "year": year
        };
      },
      /*
      @function (private) {Object} _getNextByMonth
      @description Gets the next month, the year is returned aswell in case the current month is December
      @param {Number} year
      @param {Number} month
      */
      getNextByMonth: function (year, month) {

        if (parseInt(month) + 1 > 11) {
          month = 0
          year = parseInt(year) + 1;
        } else {
          month = parseInt(month) + 1;
        }

        return {
          "month": month,
          "year": year
        };
      },
      /*
      @function (private) _showDaysGrid
      @description Shows the daysGrid and hides the other ones, it also updates the headerSelectors
      */
      showDaysGrid: function () {

        var el = this;

        el._refs.daysGrid.style.zIndex = 0;
        el._refs.daysGrid.style.opacity = 1;

        if (el._refs.monthsGrid) {
          el._hideMonthsGrid();
        }

        if (el._refs.yearsGrid) {
          el._hideYearsGrid();
        }

        el._updateHeaderSelectors("daysGrid");
        el._misc.selector.type = "month";
      },
      /*
      @function (private) _hideDaysGrid
      @description Hides the days grid
      */
      hideDaysGrid: function () {

        var el = this;

        el._refs.daysGrid.style.zIndex = -1;
        el._refs.daysGrid.style.opacity = 0;
      },
      /*
      @function (private) _showMonthsGrid
      @description Shows the months grid and hides the other ones, it also updates the headerSelectors
      */
      showMonthsGrid: function () {

        var el = this;

        el._refs.monthsGrid.style.zIndex = 0;
        el._refs.monthsGrid.style.opacity = 1;

        if (el._refs.daysGrid) {
          el._hideDaysGrid();
        }

        if (el._refs.yearsGrid) {
          el._hideYearsGrid();
        }

        el._updateHeaderSelectors("monthsGrid");
        el._handleMonthsGrid();

        el._misc.selector.type = "year";
      },
      /*
      @function (private) _hideMonthsGrid
      @description Hides the monthsGrid
      */
      hideMonthsGrid: function () {

        var el = this;

        el._refs.monthsGrid.style.zIndex = -1;
        el._refs.monthsGrid.style.opacity = 0;
      },
      /*
      @function (private) _showYearsGrid
      @description Shows the yearsGrid and hides the other ones, it also updates the headerSelectors
      */
      showYearsGrid: function () {

        var el = this;

        el._refs.yearsGrid.style.zIndex = 1;
        el._refs.yearsGrid.style.opacity = 1;

        if (el._refs.monthsGrid) {
          el._hideMonthsGrid();
        }

        if (el._refs.daysGrid) {
          el._hideDaysGrid();
        }

        el._misc.selector.range.start = parseInt(el._misc.current.year) - 6;
        el._misc.selector.range.end = parseInt(el._misc.current.year) + 5;

        el._fillYearsGrid();
        el._updateHeaderSelectors("yearsGrid");

        el._misc.selector.type = "yearsRange";
      },
      /*
      @function (private) _hideYearsGrid
      @description Hides the yearsGrid
      */
      hideYearsGrid: function () {

        var el = this;

        el._refs.yearsGrid.style.zIndex = -1;
        el._refs.yearsGrid.style.opacity = 0;
      },
      /*
      @function (private) _updateHeaderSelectors
      @description Updates the header depending on the grid passed as parameters
      @param {String} headerType
      @param {Number} year
      @param {Number} month
      */
      updateHeaderSelectors: function (headerType, year, month) {

        var el = this;

        var backButton = el.querySelector(".vc-datepicker-back");

        if (headerType == "daysGrid") {

          year = (!year) ? el._misc.current.year : year;
          month = (!month) ? el._misc.current.month : month;

          el._refs.selectorsContainer.setAttribute("class", "vc-datepicker-daysGridSelectors");

          el._refs.yearSelector.innerHTML = year;
          el._refs.yearSelector.classList.remove("hidden");

          el._refs.monthSelector.innerHTML = vcomet.time.getMonthName(el.locale, month, "long");
          el._refs.monthSelector.classList.remove("hidden");

          el.querySelector(".vc-datepicker-back").classList.add("hidden");

          el.querySelector(".vc-datepicker-previous").dataset.disabled = (el._isMinMonth(year, month)) ? "true" : "false";
          el.querySelector(".vc-datepicker-next").dataset.disabled = (el._isMaxMonth(year, month)) ? "true" : "false";

        } else if (headerType == "monthsGrid") {

          year = (!year) ? el._misc.current.year : year;

          el._refs.selectorsContainer.setAttribute("class", "vc-datepicker-monthsGridSelectors");

          el._refs.yearSelector.innerHTML = year;
          el._refs.monthSelector.classList.add("hidden");

          el.querySelector(".vc-datepicker-previous").dataset.disabled = (year <= el._misc.min.year) ? "true" : "false";
          el.querySelector(".vc-datepicker-next").dataset.disabled = (year >= el._misc.max.year) ? "true" : "false";

          if (el._refs.daysGrid) {

            backButton.classList.remove("hidden");
            backButton.dataset.grid = "days";

          } else {

            backButton.classList.add("hidden");
          }

        } else if (headerType == "yearsGrid") {

          year = (!year) ? el._misc.selector.range.start + "-" + el._misc.selector.range.end : year;

          el._refs.selectorsContainer.setAttribute("class", "vc-datepicker-yearsGridSelectors");

          el._refs.yearSelector.innerHTML = year;
          el._refs.monthSelector.classList.add("hidden");

          el.querySelector(".vc-datepicker-previous").dataset.disabled = (el._misc.selector.range.start <= el._misc.min.year) ? "true" : "false";
          el.querySelector(".vc-datepicker-next").dataset.disabled = (el._misc.selector.range.end >= el._misc.max.year) ? "true" : "false";

          if (el._refs.daysGrid) {

            backButton.classList.remove("hidden");
            backButton.dataset.grid = "days";

          } else if (el._refs.monthsGrid) {

            backButton.classList.remove("hidden");
            backButton.dataset.grid = "months";

          } else {

            backButton.classList.add("hidden");
          }
        }
      },
      /*
      @function (private) _goBack
      @description It shows the corresponding grid
      @param {Object} backButton
      */
      goBack: function (backButton) {

        var el = this;

        if (backButton.dataset.grid == "days") {

          el._showDaysGrid();

        } else if (backButton.dataset.grid == "months") {

          el._showMonthsGrid();

        } else if (backButton.dataset.grid == "years") {

          el._showYearsGrid();
        }

      },
      /*
      @function (private) _goToPrevious
      @description Handles the redirection to whether the month/year/day previous callback
      @param {Object} button
      */
      goToPrevious: function (button) {

        var el = this;

        if (el._misc.selector.type == "month") {
          el._goToPreviousMonth(button);
        } else if (el._misc.selector.type == "year") {
          el._goToPreviousYear(button);
        } else if (el._misc.selector.type == "yearsRange") {
          el._goToPreviousYearsRange(button);
        }
      },
      /*
      @function (private) _goToPreviousMonth
      @description Fills the daysGrid with the previous Month
      @param {Object} button
      */
      goToPreviousMonth: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {
          var previous = el._getPreviousByMonth(el._misc.current.year, el._misc.current.month);

          el._fillDaysGrid(previous.year, previous.month);
          el._updateHeaderSelectors("daysGrid", previous.year, previous.month);
        }
      },
      /*
      @function (private) _goToNext
      @description Handles the redirection to whether the month/year/day next callback
      @param {Object} button
      */
      goToNext: function (button) {

        var el = this;

        if (el._misc.selector.type == "month") {
          el._goToNextMonth(button);
        } else if (el._misc.selector.type == "year") {
          el._goToNextYear(button);
        } else if (el._misc.selector.type == "yearsRange") {
          el._goToNextYearsRange(button);
        }
      },
      /*
      @function (private) _goToNextMonth
      @description Fills the daysGrid with the next Month
      @param {Object} button
      */
      goToNextMonth: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {
          var next = el._getNextByMonth(el._misc.current.year, el._misc.current.month);

          el._fillDaysGrid(next.year, next.month);
          el._updateHeaderSelectors("daysGrid", next.year, next.month);
        }
      },
      /*
      @function (private) _goToPreviousYear
      @description Changes the actual year, for the previous one
      @param {Object} button
      */
      goToPreviousYear: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {

          el._misc.current.year = el._misc.current.year - 1;

          el._updateHeaderSelectors("monthsGrid");
          el._handleMonthsGrid();
        }
      },
      /*
      @function (private) _goToNextYear
      @description Changes the actual year, for the next one
      @param {Object} button
      */
      goToNextYear: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {

          el._misc.current.year = parseInt(el._misc.current.year) + 1;

          el._updateHeaderSelectors("monthsGrid");
          el._handleMonthsGrid();
        }
      },
      /*
      @function (private) _goToPreviousYearsRange
      @description Changes the actual years range, for the previous one
      @param {Object} button
      */
      goToPreviousYearsRange: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {
          el._misc.selector.range.start = el._misc.selector.range.start - 12;
          el._misc.selector.range.end = el._misc.selector.range.start + 11;

          el._fillYearsGrid();
          el._updateHeaderSelectors("yearsGrid");
        }
      },
      /*
      @function (private) _goToNextYearsRange
      @description Changes the actual years range, for the next one
      @param {Object} button
      */
      goToNextYearsRange: function (button) {

        var el = this;

        if (button.dataset.disabled != "true") {
          el._misc.selector.range.end = el._misc.selector.range.end + 12;
          el._misc.selector.range.start = el._misc.selector.range.end - 11;

          el._fillYearsGrid();
          el._updateHeaderSelectors("yearsGrid");
        }
      },
      /*
      @function (private) {Boolean} _isMinMonth
      @description Returns true if the month is equal/lower than the min month
      @param {Number} year
      @param {Number} month
      */
      isMinMonth: function (year, month) {
        return (year == this._misc.min.year && month <= this._misc.min.month || year < this._misc.min.year);
      },
      /*
      @function (private) {Boolean} _isMaxMonth
      @description Returns true if the month is equal/higher than the max month
      @param {Number} year
      @param {Number} month
      */
      isMaxMonth: function (year, month) {
        return (year == this._misc.max.year && month >= this._misc.max.month || year > this._misc.max.year);
      },
      /*
      @function (private) _handleFonts
      @description It handles the fontSizes for different picker widths
      */
      handleFonts: function () {

        var el = this;
        var calendar = this.querySelector(".vc-datepicker-calendar");

        var baseFontSize, weekDaysConstant, headerConstant;
        var daysFontSize, weekDaysFontSize, headerFontSize, navigation, otherGridsFontSize;

        weekDaysConstant = 1.0667;

        if (parseInt(calendar.offsetWidth) >= 240) {

          baseFontSize = el.fontsize;
          navigation = 24;
          headerConstant = 1.1111111111;
          otherGridsConstant = 1.1111111111;

        } else {

          baseFontSize = el.fontsize * 0.75;
          navigation = 18;
          headerConstant = 1.197916667;
          otherGridsConstant = 1.296296296;
        }

        daysFontSize = baseFontSize;
        weekDaysFontSize = baseFontSize / weekDaysConstant;
        headerFontSize = baseFontSize * headerConstant;
        otherGridsFontSize = baseFontSize * otherGridsConstant

        if (calendar.querySelector(".vc-datepicker-daysGrid")) {
          calendar.querySelector(".vc-datepicker-daysGrid .vc-datepicker-grid").style.fontSize = baseFontSize + "px";
          calendar.querySelector(".vc-datepicker-daysGrid .vc-datepicker-weekDays").style.fontSize = weekDaysFontSize + "px";
        }

        if (calendar.querySelector(".vc-datepicker-monthsGrid")) {
          calendar.querySelector(".vc-datepicker-monthsGrid").style.fontSize = otherGridsFontSize + "px"
        }

        if (calendar.querySelector(".vc-datepicker-yearsGrid")) {
          calendar.querySelector(".vc-datepicker-yearsGrid").style.fontSize = otherGridsFontSize + "px"
        }

        calendar.querySelector(".vc-datepicker-header").style.fontSize = headerFontSize + "px";

        calendar.querySelector(".vc-datepicker-back i").style.fontSize = navigation + "px";
        calendar.querySelector(".vc-datepicker-close i").style.fontSize = navigation + "px";
        calendar.querySelector(".vc-datepicker-previous i").style.fontSize = navigation + "px";
        calendar.querySelector(".vc-datepicker-next i").style.fontSize = navigation + "px";
      },
      /*
      @function (private) _refresh
      @description Shows the picker and the corresponding grid
      */
      refresh: function () {

        var el = this;

        if (el._refs.daysGrid) {

          el._fillDaysGrid(el._misc.current.year, el._misc.current.month);
          el._updateHeaderSelectors("daysGrid", el._misc.current.year, el._misc.current.month);
          el._showDaysGrid();

        } else if (el._refs.monthsGrid) {

          el._updateHeaderSelectors("monthsGrid");
          el._showMonthsGrid();

        } else if (el._refs.yearsGrid) {

          el._updateHeaderSelectors("yearsGrid");
          el._showYearsGrid();
        }

      },
      /*
      @function (private) _hide
      @description Hides the calendar
      */
      hide: function () {
        this.classList.add("hidden");
      },
      /*
      @function (private) _disableSelectors
      @description Disables the month/year selectors
      */
      disableSelectors: function () {
        this.querySelector(".vc-datepicker-header .vc-datepicker-month").dataset.disabled = "true";
        this.querySelector(".vc-datepicker-header .vc-datepicker-year").dataset.disabled = "true";
      },
      /*
      @function (private) _disableNavigation
      @description Disables the previous/next navigation buttons
      */
      disableNavigation: function () {
        this.querySelector(".vc-datepicker-leftNavigation .vc-datepicker-previous").dataset.disabled = "true";
        this.querySelector(".vc-datepicker-leftNavigation .vc-datepicker-next").dataset.disabled = "true";

        this.querySelector(".vc-datepicker-leftNavigation .vc-datepicker-previous").dataset.hidden = "true";
        this.querySelector(".vc-datepicker-leftNavigation .vc-datepicker-next").dataset.hidden = "true";
      }
    },
    functions: {
      /*
      @property setValue
      @description Changes the value to the provided one
      @param {Object} date
      */
      setValue: function (date) {

        var el = this;
        var dateObj, formattedValue;

        var day = parseInt(date.getDate());
        var month = parseInt(date.getMonth());
        var year = parseInt(date.getFullYear());

        // Check if the provided date exceeds the max date
        if (year > el._misc.max.year) {

          year = el._misc.max.year;
          month = el._misc.max.month;
          day = el._misc.max.day;

        } else if (el._isMaxMonth(year, month)) {

          month = el._misc.max.month;
          day = (day > el._misc.max.day) ? el._misc.max.day : day;

        }

        // Check if the provided date exceeds the min date
        if (year < el._misc.min.year) {

          year = el._misc.min.year;
          month = el._misc.min.month;
          day = el._misc.min.day;

        } else if (el._isMinMonth(year, month)) {

          month = el._misc.min.month;
          day = (day > el._misc.min.day) ? el._misc.min.day : day;

        }

        el._misc.current.day = day;
        el._misc.current.month = month;
        el._misc.current.year = year;

        dateObj = {

          day: el._misc.current.day,
          month: el._misc.current.month + 1,
          year: el._misc.current.year,

        };

        el._refresh();

        if (el._refs.yearsGrid) {

          var yearButton = el._refs.yearsGrid.querySelector("[data-year='" + el._misc.current.year + "']");

          if (yearButton && yearButton.dataset.disabled != "true") {
            el._highlightYear(yearButton);
          }

        }

        if (el._refs.monthsGrid) {

          var monthButton = el._refs.monthsGrid.querySelector("[data-year='" + el._misc.current.year + "'][data-index='" + el._misc.current.month + "']");

          if (monthButton && monthButton.dataset.disabled != "true") {
            el._highlightMonth(monthButton);
          }

        }

        if (el._refs.daysGrid) {

          var dayButton = el._refs.daysGrid.querySelector("[year='" + el._misc.current.year + "'][month='" + el._misc.current.month + "'][day='" + el._misc.current.day + "']");

          if (dayButton && dayButton.dataset.disabled != "true") {
            el._highlightDay(dayButton);
          }

        }

        formattedValue = el._getFormattedValue(dateObj, el.valueFormat);

        el.setAttribute("value", formattedValue);
        el.value = formattedValue;
        el.setAttribute("valid", "true");

      }
    },
    onCreated: function () {
      var el = this;
      vcomet.createCallback("onSelected", el);
    },
    onRender: function () {
      var el = this;
      el._setup();
    }
  });

</script>